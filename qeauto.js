!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("apxor")):"function"==typeof define&&define.amd?define(["apxor"],e):(t=t||self)["apxor-qe"]=e(t.Apxor)}(this,(function(t){"use strict";function e(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function n(t){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?e(Object(r),!0).forEach((function(e){s(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):e(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,l(r.key),r)}}function a(t,e,n){return e&&o(t.prototype,e),n&&o(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function s(t,e,n){return(e=l(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function u(t){return function(t){if(Array.isArray(t))return d(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return d(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return d(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function l(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t;var c=window.ApxorLogger,v=function(t){return void 0!==t&&!function(t){return null===t}(t)},h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function f(t,e){return Array.from(e).map((function(e,n){return String.fromCharCode(e^function(t,e){return t.charCodeAt(Math.floor(e%t.length))}(t,n))})).join("")}var g=function(t,e){return f(t,e=function(t){var e,n,r,i,o,a,s=0,u=[];if(!t)return t;t+="";do{e=(a=h.indexOf(t.charAt(s++))<<18|h.indexOf(t.charAt(s++))<<12|(i=h.indexOf(t.charAt(s++)))<<6|(o=h.indexOf(t.charAt(s++))))>>16&255,n=a>>8&255,r=255&a,u.push(e),64!==i&&(u.push(n),64!==o&&u.push(r))}while(s<t.length);return u}(e))},p=function(t){switch(t){case"app_event":return"AE";case"client_event":return"CE";case"activity_time":case"activity_event":return"AE"}return"Unknown"},_=function(t){return t.toUpperCase()},y=function(t,e,n){switch(n){case"EQ":return t===e;case"GT":return t>e;case"GTE":return t>=e;case"LT":return t<e;case"LTE":return t<=e;case"NEQ":return t!==e;case"R":return m(e).test(t);default:return!1}},m=function(t){var e=t.replace(/.*\/([gimuy]*)$/,"$1");e===t&&(e="");var n=e?t.replace(new RegExp("^/(.*?)/"+e+"$"),"$1"):t;return new RegExp(n,e)},b=function(){var t=new Date;return t.getDate()+"/"+t.getMonth()+"/"+t.getFullYear()},w=function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i="([^/]+)",o=n?n.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"):"",a=e.replace(new RegExp(o,"g"),i),s=new RegExp("^".concat(a)+(r?"":"$")),u=t.match(s);return null!==u};function Y(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0,o=x(t,e);if(o){var a=function(){if(E(o)){return function(t){return q(t)}(o)}return c.info("Invalid target element. Width and height are 0 for element: ".concat(t,". Can't show tooltip")),!1};return a()}return n?(c.info("Not found yet. Rechecking the DOM."),S(i,r,t,e)):(c.info("Element with selector:".concat(t," not found.")),!1)}function S(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",i=setInterval((function(){var e=x(n,r);if(e){clearInterval(i);!function(){if(E()){q()}else c.info("Invalid target element. Width and height are 0 for element: ".concat(n,". Can't show tooltip"))}()}else(t-=1)<=0&&(clearInterval(i),console.warn("Element with selector:".concat(n," not found.")))}),e)}var x=function(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=document.getElementById(t);if(!r)try{r=document.querySelector(t)}catch(t){window.ApxorLogger.error("Error finding element in DOM:"+t)}(r||(r=C(t)),!r&&n.length>0)&&(r=null===(e=document.getElementById(n))||void 0===e||null===(e=e.contentWindow)||void 0===e||null===(e=e.document)||void 0===e?void 0:e.querySelector(t));return r},C=function(t){var e=t.indexOf("svg");-1!==e&&(t=t.substring(0,e)+"svg:svg");try{return document.zjKU(t,document,(function(t){return"svg"===t?"http://www.w3.org/2000/svg":null}),XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue}catch(t){window.ApxorLogger.error("Error finding element in DOM:"+t)}return null};function E(t){try{var e=t.getBoundingClientRect();if(0===e.width||0===e.height)return!1}catch(t){return!1}return!0}function q(t){var e,n,r,i;return!!(n=(e=t).offsetHeight,r=e.offsetWidth,(i=e.getBoundingClientRect()).left>=-r&&i.top>=-n&&i.right<=(window.innerWidth||document.documentElement.clientWidth)+r&&i.bottom<=(window.innerHeight||document.documentElement.clientHeight)+n)}var A=window.ApxorLogger,I=a((function e(){var n=this;i(this,e),s(this,"gBqM","ALL"),s(this,"LqOo",[]),s(this,"NOSq",[]),s(this,"userAttributesValidated",!0),s(this,"sessionAttributeValidated",!0),s(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{if(n.gBqM=t.audience.audience_type,n.LqOo=t.audience.attributes.user,n.NOSq=t.audience.attributes.session,!Array.isArray(n.LqOo)||!Array.isArray(n.NOSq))return A.error("No attributes"),!1}catch(t){return A.error(t),!1}return!0})),s(this,"validate",(function(e,r){var i=!0;"FTU"===n.gBqM&&(i=t.getController().getSessionInfo().is_first_session);var o=n.VlDZ(e,n.LqOo),a=n.VlDZ(r,n.NOSq);return o||(n.userAttributesValidated=!1),a||(n.sessionAttributeValidated=!1),i&&o&&a})),s(this,"VlDZ",(function(t,e){var n=e.length,r=!0;try{for(var i,o=function(){var n=e[a];if(void 0===t[n.name]||!1===r)return{v:!1};var i=n.operator,o=n.type,s=n.value.map((function(t){if("s"===o)return t;if("l"===o)return parseInt(t);if("f"===o)return parseFloat(t);if("b"===o)switch(t){case"true":return!0;case"false":return!1}})),u=(Array.isArray(t[n.name])?t[n.name]:[t[n.name]]).some((function(t){return s.some((function(e){return"s"===o?t="".concat(t):"l"===o?t=parseInt(t):"f"===o?t=parseFloat(t):"b"===o&&(t=!!t),y(t,e,i)}))}));r=r&&u},a=0;a<n;a++)if(i=o())return i.v}catch(t){A.error(t),r=!1}return r}))})),T=window.ApxorLogger,k=a((function t(){var e=this;i(this,t),s(this,"YqHz",0),s(this,"FkAK",0),s(this,"pXHT","SESSION"),s(this,"XvwJ",0),s(this,"pkFn",0),s(this,"rjld",0),s(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{e.YqHz=t.frequency.count,-1===e.YqHz&&(e.YqHz=1e3),e.rjld=e.YqHz,e.FkAK=t.frequency.time_interval,e.pXHT=t.frequency.validity,e.pkFn=t.frequency.ses_lmt,e._dayCount=t.frequency.day_lmt;var n=it.getInstance().getQeState();if(!v(n)||!v(n[t._id]))return!0;if("SESSION"===e.pXHT){if(e.YqHz=parseInt(e.YqHz)-parseInt(n[t._id].SESSION),e.YqHz<=0)return console.warn("Max count limit reached for session:"+t._id),!1}else{if("OVERALL"!==e.pXHT)return T.info("Invalid config."),!1;if(e.YqHz=parseInt(e.YqHz)-parseInt(n[t._id].OVERALL),e.YqHz<=0)return console.warn("Max count limit reached for overall:"+t._id),!1}}catch(t){return T.error(t),!1}return!0})),s(this,"RYQx",(function(){e.YqHz=e.YqHz-1})),s(this,"getFrequencyCount",(function(){return e.YqHz})),s(this,"EoSZ",(function(){"SESSION"===e.pXHT&&(e.YqHz=e.rjld,T.info("Campaign Limit reset"))})),s(this,"kIrd",(function(t){try{if(e.YqHz<=0)return!1;var n=it.getInstance().getQeState();if(!v(n)||!v(n[t]))return!0;if(0!==e.pkFn)if(parseInt(e.pkFn)-parseInt(n[t].SESSION)<=0)return!1;if(0!==e._dayCount){var r,i=b();if(parseInt(e._dayCount)-parseInt((null===(r=n[t])||void 0===r?void 0:r.DATES[i])||0)<=0)return!1}}catch(t){T.error("Error validating the frequency:"+t)}return!0}))})),M=a((function t(){var e=this;i(this,t),s(this,"kSyB",""),s(this,"gBqM",""),s(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{var n,r;e.kSyB=t.meta.name,e.gBqM=t.meta.type,e._only_context=t.meta.only_context,e._attr=(null===(n=t.meta)||void 0===n?void 0:n.attr)||{},e._isExperiment=null===(r=t.meta)||void 0===r?void 0:r.isExperiment}catch(t){return window.ApxorLogger.error(t),!1}return!0}))})),L=window.ApxorLogger,N=a((function t(){var e=this;i(this,t),s(this,"MbSj",-1),s(this,"ZgMh",-1),s(this,"kUBC",-1),s(this,"tXdN",-1),s(this,"TqUw",!1),s(this,"_nudge_expired",!1),s(this,"_not_yet_active",!1),s(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{if(isNaN(Date.parse(t.validity.start_date))||isNaN(Date.parse(t.validity.end_date)))return L.error("Not valid dates"),!1;if(e.MbSj=Date.parse(t.validity.start_date),e.ZgMh=Date.parse(t.validity.end_date),v(t.time_limits_in_day)&&(e.TqUw=t.time_limits_in_day,e.TqUw&&v(t.time_limits))){var n=(new Date).toISOString().split("T")[0];if(e.kUBC=Date.parse(n+"T"+t.time_limits.start_time+".000Z"),e.tXdN=Date.parse(n+"T"+t.time_limits.end_time+".000Z"),isNaN(e.kUBC)||isNaN(e.tXdN))return L.error("Not valid times"),!1}}catch(t){return L.error(t),!1}return!0})),s(this,"validate",(function(){var t=Date.now();return t>e.MbSj&&t<e.ZgMh?!e.TqUw||t>=e.kUBC&&t<=e.tXdN:(t<e.MbSj?e._not_yet_active=!0:t>e.ZgMh&&(e._nudge_expired=!0),!1)}))})),O=a((function t(){var e=this;i(this,t),s(this,"kSyB",""),s(this,"ldIw",{}),s(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{e.kSyB=t.name,e.ldIw=t.additional_info}catch(t){return!1}return!0}))})),B=a((function t(){var e=this;i(this,t),s(this,"lcKS",0),s(this,"tlVC",0),s(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{if(e.lcKS=Number(t.lower),e.tlVC=Number(t.upper),isNaN(e.lcKS)||isNaN(e.tlVC))return!1}catch(t){return!1}return!0}))})),H=a((function t(){var e=this;i(this,t),s(this,"pWqh",0),s(this,"ZGbS",""),s(this,"ERrk",""),s(this,"Mvod",new O),s(this,"YQhe",new B),s(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{return e.ZGbS=t.event_type,e.ERrk=t.activity,e.Mvod.parse(t.details)&&e.YQhe.parse(t.time_bounds)}catch(t){return!1}}))})),D=window.ApxorLogger,Q=a((function t(){var e=this;i(this,t),s(this,"pWqh",0),s(this,"FKfC",-1),s(this,"YqHz",0),s(this,"BuCR",""),s(this,"ERrk",""),s(this,"ZGbS",""),s(this,"YQhe",new B),s(this,"Mvod",new O),s(this,"VDHj",new H),s(this,"Ktud","AND"),s(this,"jnvu",!1),s(this,"gBqM",void 0),s(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{return e.FKfC=t.sequence,e.YqHz=t.count_config.count,e.BuCR=t.count_config.operator,e.ERrk=t.activity,e.ZGbS=t.event_type,e.Ktud=t.combine_operator,e.gBqM=t.type,e.Mvod.parse(t.details)&&e.VDHj.parse(t.trigger)&&e.YQhe.parse(t.time_bounds)}catch(t){return D.error(t),!1}}))})),F=window.ApxorLogger,R=a((function t(){var e=this;i(this,t),s(this,"YqHz",0),s(this,"BuCR",""),s(this,"ZGbS",""),s(this,"YQhe",new B),s(this,"Mvod",new O),s(this,"Ktud","AND"),s(this,"parse",(function(t){try{return e.YqHz=t.count_config.count,e.BuCR=t.count_config.operator,e.ZGbS=t.event_type,e.Ktud=t.combine_operator,e.Mvod.parse(t.details)&&e.YQhe.parse(t.time_bounds)}catch(t){return F.error(t),!1}}))})),z=window.ApxorLogger,P=function(){function e(){var n=this;i(this,e),s(this,"Ayyq",0),s(this,"mQTO",""),s(this,"HtnL",new Q),s(this,"kued",new R),s(this,"ayIg",!1),s(this,"brIN",!1),s(this,"svvL",0),s(this,"Ktud","AND"),s(this,"uoIz","OR"),s(this,"JLIw",-1),s(this,"hmIh",[]),s(this,"evak",{}),s(this,"NVQH",!1),s(this,"initialize",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";if(n.mQTO=r,n.svvL=i,n.hmIh=a,"termination"===s&&""!==s){n.kued.parse(e);return n.uoIz=n.kued.Ktud,n.jZgB(),!0}var u=n.HtnL.parse(e);if(u){if(n.Ktud=n.HtnL.Ktud,n.HtnL.jnvu){var d=n.HtnL.Mvod.kSyB;"APX_PAGE_OPENED"===d&&(d=n.HtnL.Mvod.ldIw.navigation_id,d=v(d)?d:n.HtnL.Mvod.kSyB),n.JLIw=t.getController().getEventCount(d);var l=n.HtnL.YqHz,c=n.HtnL.BuCR;if(n.brIN=n.LhPS(n.JLIw-1,l,c,!1),n.ayIg=n.brIN,n.brIN&&"APX_PAGE_OPENED"===n.HtnL.Mvod.kSyB)return!0}return o&&0!==i||n.zbvE(),!0}return!1})),s(this,"zbvE",(function(){var t,e=n.HtnL,r=e.VDHj,i=it.getInstance();"app_start"===r.ZGbS?(n.ayIg=!0,i.registerForEvent(p(e.ZGbS)+"___"+e.Mvod.kSyB,n.rlNR)):i.registerForEvent(p(e.ZGbS)+"___"+r.Mvod.kSyB,n.rlNR),null!==(t=window.ApxorRTM)&&void 0!==t&&t.badgesLists.includes(n.mQTO)&&i.registerForEvent(p(e.ZGbS)+"___"+"apxor-badge-container-".concat("-".concat(n.mQTO).replaceAll(" ","").replace(/[^\w\s]/gi,"")),n.rlNR)})),s(this,"jZgB",(function(){var t=n.kued,e=it.getInstance();n.ayIg=!0,e.registerForEvent(p(t.ZGbS)+"___"+t.Mvod.kSyB,n.JMxV)})),s(this,"xMiM",(function(t,e,r,i){var o,a=(Date.now()-n.evak[e])/1e3;(null===(o=n.HtnL)||void 0===o||null===(o=o.Mvod)||void 0===o||null===(o=o.ldIw)||void 0===o?void 0:o.time)/1e3>a&&n._displayCampaign(r)})),s(this,"FgZU",(function(t,e,r,i){var o,a;n.NVQH=!0;var s=Date.now(),u=null===(o=n.HtnL)||void 0===o||null===(o=o.VDHj)||void 0===o?void 0:o.Mvod.kSyB,d=(s-n.evak[u])/1e3,l=null===(a=n.HtnL)||void 0===a||null===(a=a.Mvod)||void 0===a||null===(a=a.ldIw)||void 0===a?void 0:a.time;(l/=1e3)>d&&n._displayCampaign(r)})),s(this,"rlNR",(function(e,r,i,o){var a,s,u=it.getInstance();if(n.ayIg){if(null!==(a=window.ApxorRTM)&&void 0!==a&&a.isBadgePresent&&null!==(s=window.ApxorRTM)&&void 0!==s&&s.badgesLists.includes(n.mQTO)&&t.getController().isBadgeTriggerSatisfied(n.mQTO))return n.brIN=!0,n.HtnL.pWqh=i,void u.validate(n.mQTO,n.svvL);p(n.HtnL.ZGbS)===e&&n.JbPB(i-n.HtnL.VDHj.pWqh,n.HtnL.YQhe)&&n.HtnL.Mvod.kSyB===r&&n.dkZo(n.HtnL.Mvod.ldIw,o)&&(n.Ayyq+=1,n.brIN=n.LhPS(n.Ayyq,n.HtnL.YqHz,n.HtnL.BuCR),n.brIN&&(n.HtnL.pWqh=i,u.validate(n.mQTO,n.svvL)))}else if(n.ayIg=n.ueiM(e,r,i,o),n.ayIg){var d=n.HtnL,l=d.VDHj;if(l.pWqh=i,"activity_time"===(null==d?void 0:d.ZGbS)){var c,v,h,f=null==d||null===(c=d.Mvod)||void 0===c||null===(c=c.ldIw)||void 0===c?void 0:c.time;(null==d||null===(v=d.Mvod)||void 0===v||null===(v=v.ldIw)||void 0===v?void 0:v.nkpi.length)>0&&(setTimeout((function(){n.NVQH||(n.brIN=!0,n.brIN&&(n.Ayyq+=1,n.brIN=n.LhPS(n.Ayyq,n.HtnL.YqHz,n.HtnL.BuCR),n.brIN&&(n.HtnL.pWqh=i,u.validate(n.mQTO,n.svvL)))),d.Mvod.ldIw.nkpi.map((function(t){u.unregisterFromEvent(_(d.Mvod.ldIw.et)+"___"+t,n)}))}),f),d.Mvod.ldIw.nkpi.map((function(t){u.registerForEvent(_(d.Mvod.ldIw.et)+"___"+t,n.FgZU)}))),(null==d||null===(h=d.Mvod)||void 0===h||null===(h=h.ldIw)||void 0===h?void 0:h.kpi.length)>0&&(setTimeout((function(){d.Mvod.ldIw.kpi.map((function(t){u.unregisterFromEvent(_(d.Mvod.ldIw.et)+"___"+t,n)}))}),f),d.Mvod.ldIw.kpi.map((function(t){t===d.VDHj.Mvod.kSyB?(u.unregisterFromEvent(p(l.ZGbS)+"___"+l.Mvod.kSyB,n),u.registerForEvent(_(d.Mvod.ldIw.et)+"___"+t,n.xMiM)):u.registerForEvent(_(d.Mvod.ldIw.et)+"___"+t,n.FgZU)})))}else u.unregisterFromEvent(p(l.ZGbS)+"___"+l.Mvod.kSyB,n),u.registerForEvent(p(d.ZGbS)+"___"+d.Mvod.kSyB,n);n.evak[r]=Date.now()}})),s(this,"JMxV",(function(t,e,r,i){var o=it.getInstance();p(n.kued.ZGbS)===t&&n.JbPB(r,n.kued.YQhe)&&n.kued.Mvod.kSyB===e&&n.dkZo(n.kued.Mvod.ldIw,i)&&(n.Ayyq+=1,n.brIN=n.LhPS(n.Ayyq,n.kued.YqHz,n.kued.BuCR),n.brIN&&(n.kued.pWqh=r,o.validateForTermination(n.mQTO,n.svvL)))})),s(this,"ueiM",(function(t,e,r,i){var o=n.HtnL.VDHj;return p(o.ZGbS)===t&&o.Mvod.kSyB===e&&n.JbPB(r,o.YQhe)&&n.dkZo(o.Mvod.ldIw,i)})),s(this,"JbPB",(function(t,e){var n=Math.ceil(t);return n>e.lcKS&&n<e.tlVC})),s(this,"LhPS",(function(t,e,r){var i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];switch(i&&n.HtnL.jnvu&&(t+=n.JLIw),r){case"EQ":return t===e;case"GT":return t>e;case"GTE":return t>=e;case"LT":return t<e;case"LTE":return t<=e;default:return!1}})),s(this,"dkZo",(function(t,e){var n=!0;try{var i,o=function(){if(!e[a]||!1===n)return{v:!1};if("object"===r(t[a])){var i,o=t[a].op,s=t[a].t;"s"===s?i=t[a].val:"l"!==s&&"f"!==s||(i=parseFloat(t[a].val));var u=(Array.isArray(e[a])?e[a]:[e[a]]).some((function(t){return y(t,i,o)}));n=n&&u}else n=n&&y(e[a],t[a],"EQ")};for(var a in t)if(i=o())return i.v}catch(t){z.error(t),n=!1}return n}))}return a(e,[{key:"_displayCampaign",value:function(t){var e=it.getInstance();this.brIN=!0,this.brIN&&(this.Ayyq+=1,this.brIN=this.LhPS(this.Ayyq,this.HtnL.YqHz,this.HtnL.BuCR),this.brIN&&(this.HtnL.pWqh=t,e.validate(this.mQTO,this.svvL)))}}]),e}(),V="apx_variant_code",G=window.ApxorLogger,Z=a((function e(){var n=this;i(this,e),s(this,"hags",[]),s(this,"_ret_day",{}),s(this,"ZZxa",{}),s(this,"PAsm",!1),s(this,"jBQY",!1),s(this,"retainedDaysValidated",!0),s(this,"retainedSessionValidated",!0),s(this,"eventDoneInLT",!1),s(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{n.hags=t.overall_cfg.events,n._ret_day=t.overall_cfg.ret_day,n.ZZxa=t.overall_cfg.session,n.PAsm=t.overall_cfg.toggleRetDay,n.jBQY=t.overall_cfg.toggleSession}catch(t){return G.error(t),!1}return!0})),s(this,"validate",(function(){var e=parseInt(t.getController().getFromStorage("apx_retained_days")),r=parseInt(t.getController().getFromStorage("apx_retained_session"));if(n.PAsm&&!isNaN(e)&&!(e>=n._ret_day.from&&e<=n._ret_day.to))return n.retainedDaysValidated=!1,!1;if(n.jBQY&&!isNaN(r)&&!(r>=n.ZZxa.from&&r<=n.ZZxa.to))return n.retainedSessionValidated=!1,!1;try{for(var i=t.getController().getFromStorage("_apx_lt_count"),o=t.getSiteId(),a=JSON.parse((new TextDecoder).decode(function(t){for(var e=new ArrayBuffer(t.length),n=new Uint8Array(e),r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return e}(g(o,i)))),s=0;s<n.hags.length;s++){if(a[n.hags[s].name.replace("'","").replace("â€™","")])return n.eventDoneInLT=!0,!1}}catch(t){G.error("Failed to validate the lt count:"+t)}return!0}))})),j=window.ApxorLogger,X=a((function t(){var e=this;i(this,t),s(this,"LqOo",[]),s(this,"NOSq",[]),s(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{if(e.LqOo=t.attributes.user,e.NOSq=t.attributes.session,!Array.isArray(e.LqOo)||!Array.isArray(e.NOSq))return j.error("No attributes"),!1}catch(t){return j.error(t),!1}return!0})),s(this,"validate",(function(t,n){return e.VlDZ(t,e.LqOo)&&e.VlDZ(n,e.NOSq)})),s(this,"VlDZ",(function(t,e){var n=e.length,r=!0;try{for(var i,o=function(){var n=e[a];if(!t[n.name]||!1===r)return{v:!1};var i=n.operator,o=n.type,s=n.value.map((function(t){return"s"===o?t:"l"===o?parseInt(t):"f"===o?parseFloat(t):void 0})),u=(Array.isArray(t[n.name])?t[n.name]:[t[n.name]]).some((function(t){return s.some((function(e){return y(t,e,i)}))}));r=r&&u},a=0;a<n;a++)if(i=o())return i.v}catch(t){j.error(t),r=!1}return r}))})),U=a((function e(){var n=this;i(this,e),s(this,"LLRu",t.getController()),s(this,"type",""),s(this,"_duration_seconds",0),s(this,"XFku",1),s(this,"parse",(function(t){try{var e,r,i;if(n.gBqM=null===(e=t.terminate_info.time_based)||void 0===e?void 0:e.type,n._duration_seconds=null===(r=t.terminate_info)||void 0===r?void 0:r.time_based.duration_seconds,n.XFku=null===(i=t.terminate_info.time_based)||void 0===i?void 0:i.days,n.NcqP(t._id))return n.LLRu.persistTerminationInfoLocally(t._id),!1}catch(t){return!1}return!0})),s(this,"NcqP",(function(t){var e,r=JSON.parse(n.LLRu.getFromStorage("apx_termination_ID"));if(!r[t]||null===(e=r[t])||void 0===e||!e.startDate)return!1;var i,o=new Date(r[t].startDate),a=new Date((i=new Date).getMonth()+"/"+i.getDate()+"/"+i.getFullYear()),s=parseInt((a-o)/864e5,10),u=function(){var t=new Date;return{hours:t.getHours(),mins:t.getMinutes()}}(),d=r[t].kUBC;return s===n.XFku&&u.hours>=d.hours||s>n.XFku||r[t].goalAcheived}))})),K=a((function t(){var e=this;i(this,t),s(this,"enable_goal_events",!1),s(this,"attributes",{}),s(this,"sbuY",new X),s(this,"aQHm",new U),s(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{var n,r,i;if(e.enable_time_based=null==t||null===(n=t.terminate_info)||void 0===n?void 0:n.enable_time_based,e.enable_time_based&&!e.aQHm.parse(t))return!1;if(e.enable_goal_events=null==t||null===(r=t.terminate_info)||void 0===r?void 0:r.enable_goal_events,e.enable_attributes=null==t||null===(i=t.terminate_info)||void 0===i?void 0:i.enable_attributes,e.enable_attributes&&!e.sbuY.parse(t.terminate_info))return!1}catch(t){return window.ApxorLogger.error(t),!1}return!0})),s(this,"validate",(function(t,n){return e.sbuY.validate(t,n)}))})),W=a((function t(){var e=this;i(this,t),s(this,"JdCM",""),s(this,"ZNiT",""),s(this,"OYGX",""),s(this,"qDXf",""),s(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{return e.JdCM=null==t?void 0:t.screen_binding,!e.JdCM||(e.ZNiT=null==t?void 0:t.binding.url,e.OYGX=null==t?void 0:t.binding.var,e.qDXf=null==t?void 0:t.binding.operator,!0)}catch(t){return window.ApxorLogger.error(t),!1}})),s(this,"validate",(function(){var t=e.ZNiT,n=e.OYGX,r=e.qDXf,i=window.location.href;return!e.JdCM||("EQ"===r?t.includes(n)?!!w(i,t,n,!1):i===t:"SW"===r?t.includes(n)?!!w(i,t,n,!0):!!i.startsWith(t):void 0)}))})),J=window.ApxorLogger,$=a((function e(){var r=this;i(this,e),s(this,"wTCa",[]),s(this,"WXfB",[]),s(this,"mQTO",""),s(this,"dCYY",new M),s(this,"GnQK",new I),s(this,"pXHT",new N),s(this,"yCkh",new k),s(this,"MxCm",new Z),s(this,"IVha",new K),s(this,"AvKe",new W),s(this,"gDKI",!1),s(this,"tgpb",[]),s(this,"_variant_code",""),s(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{var e;if(!v(t._id))return J.error("No Id"),!1;if(!v(t.enabled)||!t.enabled)return J.error("Not enabled"),!1;if(!(r.dCYY.parse(t)&&r.pXHT.parse(t)&&r.yCkh.parse(t)&&r.GnQK.parse(t)&&r.MxCm.parse(t)&&r.IVha.parse(t)&&r.AvKe.parse(t)))return!1;if(r._variant_code=r.dCYY._isExperiment||r.dCYY._only_context?null===(e=r.dCYY._attr)||void 0===e?void 0:e[V]:"TG",!v(t.conditions)||!Array.isArray(t.conditions))return J.error("No valid conditions",t.conditions),!1;r.mQTO=t._id,r.gDKI=!!v(t.sequence_enabled)&&t.sequence_enabled,r.gDKI&&t.conditions.sort((function(t,e){return t.sequence<e.sequence}));var n=t.conditions,i=n.length,o=null==t?void 0:t.no_context_enabled;0===i&&o&&r.vwSw();for(var a=function(){r.tgpb=[];var t=n[s];if("didn't"===t.type){var e,i={trigger_key:t.trigger.details.name,no_kpi_array:null==t||null===(e=t.details)||void 0===e||null===(e=e.additional_info)||void 0===e?void 0:e.nkpi,condition_id:null==t?void 0:t._id,time_bounds:t.time_bounds.upper};r.tgpb=[].concat(u(r.tgpb),[i])}var o=new P;if(o.initialize(t,r.mQTO,s,r.gDKI,r.tgpb)){r.wTCa.push(o);var a=(null==t?void 0:t.timeout)/(null==t?void 0:t.findinterval),d=(null==t?void 0:t.frameid)||"",l=null==t?void 0:t.url;window.location.href===l&&"view_visibility"===t.event_type&&!0===Y(t.view_id,d,null==t?void 0:t.enable_retry,null==t?void 0:t.findinterval,a)&&r.vwSw(!0),window.addEventListener("navigate",(function(e){var n=null==t?void 0:t.url;window.location.href===n&&"view_visibility"===t.event_type&&!0===Y(t.view_id,d,null==t?void 0:t.enable_retry,null==t?void 0:t.findinterval,a)&&r.vwSw(!0)}))}},s=0;s<i;s++)a();if(r.IVha.enable_goal_events)for(var d=t.terminate_info.goal_events.events,l=d.length,c=0;c<l;c++){var h=new P;h.initialize(d[c],r.mQTO,c,!0,[],"termination")&&r.WXfB.push(h)}return r.wTCa.length>0}catch(t){return J.error(t),!1}})),s(this,"zjKU",(function(t){if(!(t<0))if(r.gDKI){var e=r.wTCa[t];if(v(e)&&e.brIN){var n=r.wTCa[t-1];if(v(n)&&!n.brIN)return;var i=r.wTCa[t+1];v(i)?i.zbvE():r.vwSw()}}else r.vwSw()})),s(this,"ZLLA",(function(t){t<0||r.UuHW()})),s(this,"vwSw",(function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=t.getController().getUserAttributes(),o=t.getController().getSessionAttributes();if(!(r.pXHT.validate()&&r.GnQK.validate(i,o)&&r.MxCm.validate()&&r.AvKe.validate()))return r.MxCm.retainedDaysValidated||null==t||t.logEvent("apx_non_eligible_user",{apx_nudge_type:"SURVEY"===r.dCYY.gBqM?"survey":"campaign",apx_nudge_id:r.mQTO,apx_nudge_name:r.dCYY.kSyB,apx_variant_code:r.dCYY._isExperiment||r.dCYY._only_context?r.dCYY._attr[V]:"TG",apx_failure_type:"warn",apx_reason:"Retained day criteria not met"}),r.MxCm.retainedSessionValidated||null==t||t.logEvent("apx_non_eligible_user",{apx_nudge_type:"SURVEY"===r.dCYY.gBqM?"survey":"campaign",apx_nudge_id:r.mQTO,apx_nudge_name:r.dCYY.kSyB,apx_variant_code:r.dCYY._isExperiment||r.dCYY._only_context?r.dCYY._attr[V]:"TG",apx_failure_type:"warn",apx_reason:"User session criteria not met"}),r.MxCm.eventDoneInLT&&(null==t||t.logEvent("apx_non_eligible_user",{apx_nudge_type:"SURVEY"===r.dCYY.gBqM?"survey":"campaign",apx_nudge_id:r.mQTO,apx_nudge_name:r.dCYY.kSyB,apx_variant_code:r.dCYY._isExperiment||r.dCYY._only_context?r.dCYY._attr[V]:"TG",apx_failure_type:"warn",apx_reason:"Event done in life time"})),r.GnQK.userAttributesValidated||null==t||t.logEvent("apx_non_eligible_user",{apx_nudge_type:"SURVEY"===r.dCYY.gBqM?"survey":"campaign",apx_nudge_id:r.mQTO,apx_nudge_name:r.dCYY.kSyB,apx_variant_code:r.dCYY._isExperiment||r.dCYY._only_context?r.dCYY._attr[V]:"TG",apx_failure_type:"warn",apx_reason:"User property filter not met"}),r.GnQK.sessionAttributeValidated||null==t||t.logEvent("apx_non_eligible_user",{apx_nudge_type:"SURVEY"===r.dCYY.gBqM?"survey":"campaign",apx_nudge_id:r.mQTO,apx_nudge_name:r.dCYY.kSyB,apx_variant_code:r.dCYY._isExperiment||r.dCYY._only_context?r.dCYY._attr[V]:"TG",apx_failure_type:"warn",apx_reason:"Session property filter not met"}),r.pXHT._not_yet_active&&(null==t||t.logEvent("apx_non_eligible_user",{apx_nudge_type:"SURVEY"===r.dCYY.gBqM?"survey":"campaign",apx_nudge_id:r.mQTO,apx_nudge_name:r.dCYY.kSyB,apx_variant_code:r.dCYY._isExperiment||r.dCYY._only_context?r.dCYY._attr[V]:"TG",apx_failure_type:"warn",apx_reason:"nudge not yet active"})),void(r.pXHT._nudge_expired&&(null==t||t.logEvent("apx_non_eligible_user",{apx_nudge_type:"SURVEY"===r.dCYY.gBqM?"survey":"campaign",apx_nudge_id:r.mQTO,apx_nudge_name:r.dCYY.kSyB,apx_variant_code:r.dCYY._isExperiment||r.dCYY._only_context?r.dCYY._attr[V]:"TG",apx_failure_type:"warn",apx_reason:"nudge expired"})));var a=r.wTCa.length,s=a<1,u="";0===a&&(s=!0);for(var d=0;d<a;d++){var l=r.wTCa[d],c=l.brIN;if(""===u.trim())s=c;else switch(u){case"AND":s=s&&c;break;case"OR":s=s||c}u=l.Ktud}if(!0===e&&(s=!0),s){var v,h;if(console.debug("onCondition satisfied"),!r.yCkh.kIrd(r.mQTO))return console.warn("Maximum limit reached",r.mQTO),void(null==t||t.logEvent("apx_non_eligible_user",{apx_nudge_type:"campaign",apx_nudge_id:r.mQTO,apx_nudge_name:r.dCYY.kSyB,apx_variant_code:r.dCYY._isExperiment||r.dCYY._only_context?r.dCYY._attr[V]:"TG",apx_failure_type:"warn",apx_reason:"Campaign limit reached"}));null!==(v=window.ApxorRTM)&&void 0!==v&&v.isBadgePresent&&null!==(h=window.ApxorRTM)&&void 0!==h&&h.badgesLists.includes(r.mQTO)&&t.getController().isBadgeTriggerSatisfied(r.mQTO)||null==t||t.logEvent("apx_trigger_satisfied",{apx_nudge_type:"SURVEY"===r.dCYY.gBqM?"survey":"campaign",apx_nudge_id:r.mQTO,apx_nudge_name:r.dCYY.kSyB,apx_variant_code:r.dCYY._isExperiment||r.dCYY._only_context?r.dCYY._attr[V]:"TG"}),console.log("Dispatching event",r.dCYY.gBqM),!0===r.dCYY._only_context&&t.logEvent("apx_context_evaluated",n(n({},r.dCYY._attr),{},{message_name:r.dCYY.kSyB,id:r.mQTO})),t.getController().dispatchEvent(r.dCYY.gBqM,{name:r.dCYY.gBqM,additional_info:{uuid:r.mQTO,name:r.dCYY.kSyB}})}})),s(this,"UuHW",(function(){for(var e=r.WXfB.length,i=e<1,o="",a=0;a<e;a++){var s=r.WXfB[a],u=s.brIN;if(""===o.trim())i=u;else switch(o){case"AND":i=i&&u;break;case"OR":i=i||u}o=s.uoIz}i&&(console.log("Dispatching event",r.dCYY.gBqM),t.getController().persistTerminationInfoLocally(r.mQTO),!0===r.dCYY._only_context&&t.logEvent("apx_context_evaluated",n(n({},r.dCYY._attr),{},{message_name:r.dCYY.kSyB,id:r.mQTO})),t.getController().dispatchEvent(r.dCYY.gBqM,{name:r.dCYY.gBqM,additional_info:{uuid:r.mQTO,name:r.dCYY.kSyB}}))})),s(this,"validateForTerminationAttributes",(function(){var e=t.getController().getUserAttributes(),n=t.getController().getSessionAttributes();return r.IVha.validate(e,n)})),s(this,"RYQx",(function(){r.yCkh.RYQx()})),s(this,"getFrequencyCount",(function(){return r.yCkh.getFrequencyCount()})),s(this,"FzkX",(function(){return r.yCkh.EoSZ()}))})),tt=a((function t(){var e=this;i(this,t),s(this,"vpPz",{}),s(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{configs:[]};if(v(t)&&v(t.configs)){var n=t.configs;if(!Array.isArray(n))return;n.sort((function(t,e){var n,r;return(null!==(n=t.prio)&&void 0!==n?n:-1)-(null!==(r=e.prio)&&void 0!==r?r:-1)}));for(var r=0;r<n.length;r++){var i=n[r],o=i._id,a=new $;a.parse(i)?e.vpPz[o]=a:console.warn("Failed to parse cfg",o)}}})),s(this,"validate",(function(t,n){e.vpPz[t]&&e.vpPz[t].zjKU(n)})),s(this,"getVariantCode",(function(t){return e.vpPz[t]?e.vpPz[t]._variant_code:""})),s(this,"validateForTermination",(function(t,n){e.vpPz[t]&&e.vpPz[t].ZLLA(n)})),s(this,"validateForTerminationAttributes",(function(t){return!!e.vpPz[t]&&e.vpPz[t].validateForTerminationAttributes()})),s(this,"RYQx",(function(t){e.vpPz[t].RYQx()})),s(this,"getFrequencyCount",(function(t){var n=e.vpPz[t];if(null!=n)return n.getFrequencyCount()})),s(this,"resetFrequencyCounts",(function(){var t=e.vpPz;for(var n in t)t[n].FzkX()})),s(this,"xQhD",(function(t){try{if(e.vpPz){var n=e.vpPz[t];if(n&&n.dCYY)return n.dCYY}}catch(t){console.log("Error in getting the campaign meta ".concat(t))}return{}}))})),et=window.ApxorLogger,nt=a((function e(){var n=this;i(this,e),s(this,"ckGy",{}),s(this,"vGaq",[]),s(this,"MPXS",!1),s(this,"initialize",(function(){var e=t.getController();e.registerForEvent("APP_EVENT",(function(t){return n.czfS(t,"AE")})),e.registerForEvent("CLIENT_EVENT",(function(t){return n.czfS(t,"CE")}))})),s(this,"ddVd",(function(){for(var t in n.vGaq)n.fCbq(t.event,t.key,t.type);n.MPXS=!0})),s(this,"kWLA",(function(t,e){var r;"function"==typeof e&&((r=n.ckGy[t]?n.ckGy[t]:[]).push(e),n.ckGy[t]=r,et.debug("Listeners list: ",n.ckGy))})),s(this,"unregisterFromEvent",(function(t,e){if(n.ckGy[t]){for(var r=n.ckGy[t],i=[],o=0;o<r.length;o++){var a=r[o];a!==e&&i.push(a)}n.ckGy[t]=i}})),s(this,"czfS",(function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"AE",r=e+"___"+t.name;n.fCbq(t,r,e)})),s(this,"fCbq",(function(e,r,i){if(n.MPXS){if(et.debug("Notifying listeners for event: "+e+", "+r,n.ckGy),n.ckGy[r])for(var o=n.ckGy[r],a=t.getController().getSDKRunningTimeInSec(),s=0;s<o.length;s++){(0,o[s])(i,e.name,a,e.additional_info)}}else n.vGaq.push({event:e,key:r,type:i})}))})),rt=window.ApxorLogger,it=function(){function e(){var n=this;return i(this,e),s(this,"Mayn",!1),s(this,"SkfY",null),s(this,"HMCB",b()),s(this,"PbDH",new nt),s(this,"ExEn",t.getSiteId()),s(this,"xehN",{}),s(this,"getQeState",(function(){try{var e=t.getController().getFromStorage("qe_state");return e?JSON.parse(g(n.ExEn,e)):(n.xehN={},n.setQeState())}catch(t){return n.xehN={},n.setQeState()}})),s(this,"setQeState",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";try{t.getController().persistToStorage("qe_state",n.xehN,!0)}catch(r){""===e?n.xehN={}:n.xehN[e]={SESSION:0,OVERALL:0,DATES:{}},t.getController().persistToStorage("qe_state",n.xehN,!0)}return n.xehN})),s(this,"initialize",(function(){n.Mayn||(n.Mayn=!0,n.SkfY=new tt,n.PbDH.initialize(),n.xehN=n.getQeState(),rt.info("QE Initialized.."))})),s(this,"parse",(function(t){n.BRzf()?(n.SkfY.parse(t),n.PbDH.ddVd()):rt.warn("Must call init first. Unable to proceed")})),s(this,"validate",(function(t,e){n.BRzf()&&n.SkfY.validate(t,e)})),s(this,"getVariantCode",(function(t){return n.SkfY.getVariantCode(t)})),s(this,"validateForTermination",(function(t,e){n.BRzf()&&n.SkfY.validateForTermination(t,e)})),s(this,"validateForTerminationAttributes",(function(t,e){return n.SkfY.validateForTerminationAttributes(t,e)})),s(this,"updateCount",(function(t){try{v(n.xehN[t])||n.createObjConfig(t),n.incrementFrequencies(t),n.setQeState(t),n.SkfY.RYQx(t)}catch(t){console.log("Could not update the count config:".concat(t))}})),s(this,"resetFrequencyCounts",(function(){n.SkfY.resetFrequencyCounts()})),s(this,"getFrequencyCount",(function(t){return n.SkfY.getFrequencyCount(t)})),s(this,"registerForEvent",(function(t,e){n.PbDH.kWLA(t,e)})),s(this,"unregisterFromEvent",(function(t,e){n.PbDH.unregisterFromEvent(t,e)})),s(this,"notifyEventListener",(function(t){n.PbDH.czfS(t)})),s(this,"fetch",(function(e,n,r,i){t.getController().fetchConfiguration(e,n,r,i)})),s(this,"BRzf",(function(){return n.Mayn})),s(this,"getCampaignMetaFromQueryEngine",(function(t){return n.SkfY.xQhD(t)})),s(this,"NpXA",(function(){return n.HMCB})),e.instance||(e.instance=this),e.instance}return a(e,[{key:"createObjConfig",value:function(t){try{this.xehN=this.getQeState(),v(this.xehN[t])||(this.xehN[t]={SESSION:0,OVERALL:0,DATES:{}},this.HMCB&&(this.xehN[t].DATES[this.HMCB]=0),this.setQeState(t))}catch(t){rt.error("Can not create the frequency count object:"+t)}}},{key:"incrementFrequencies",value:function(t){this.xehN=this.getQeState();var e=this.xehN[t];e.SESSION=e.SESSION+1,e.OVERALL=e.OVERALL+1;var n=b();n===this.HMCB&&e.DATES&&e.DATES[n]||(this.HMCB=n,e.DATES={},e.DATES[this.HMCB]=0),e.DATES[this.HMCB]=e.DATES[this.HMCB]+1}}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}]),e}();s(it,"instance",void 0),window.ceVersion=151;try{void 0===exports&&null===exports||(exports.default=it,module.exports=exports.default)}catch(t){}return it}));
