!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("apxor")):"function"==typeof define&&define.amd?define(["apxor"],e):(t=t||self)["apxor-qe"]=e(t.Apxor)}(this,(function(t){"use strict";function e(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function n(t){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?e(Object(r),!0).forEach((function(e){s(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):e(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,c(r.key),r)}}function o(t,e,n){return e&&a(t.prototype,e),n&&a(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function s(t,e,n){return(e=c(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function u(t){return function(t){if(Array.isArray(t))return l(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return l(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return l(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function c(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t;var d=function(t){return void 0!==t&&!function(t){return null===t}(t)},h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function v(t,e){return Array.from(e).map((function(e,n){return String.fromCharCode(e^function(t,e){return t.charCodeAt(Math.floor(e%t.length))}(t,n))})).join("")}var p=function(t,e){return v(t,e=function(t){var e,n,r,i,a,o,s=0,u=[];if(!t)return t;t+="";do{e=(o=h.indexOf(t.charAt(s++))<<18|h.indexOf(t.charAt(s++))<<12|(i=h.indexOf(t.charAt(s++)))<<6|(a=h.indexOf(t.charAt(s++))))>>16&255,n=o>>8&255,r=255&o,u.push(e),64!==i&&(u.push(n),64!==a&&u.push(r))}while(s<t.length);return u}(e))},f=function(t){switch(t){case"app_event":return"AE";case"client_event":return"CE";case"activity_time":case"activity_event":return"AE"}return"Unknown"},_=function(t){return t.toUpperCase()},g=function(t,e,n){switch(n){case"EQ":return t===e;case"GT":return t>e;case"GTE":return t>=e;case"LT":return t<e;case"LTE":return t<=e;case"NEQ":return t!==e;case"R":return y(e).test(t);default:return!1}},y=function(t){var e=t.replace(/.*\/([gimuy]*)$/,"$1");e===t&&(e="");var n=e?t.replace(new RegExp("^/(.*?)/"+e+"$"),"$1"):t;return new RegExp(n,e)},m=function(){var t=new Date;return t.getDate()+"/"+t.getMonth()+"/"+t.getFullYear()},x=function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i="([^/]+)",a=n?n.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"):"",o=e.replace(new RegExp(a,"g"),i),s=new RegExp("^".concat(o)+(r?"":"$")),u=t.match(s);return null!==u},E=window.ApxorLogger,b=o((function e(){var n=this;i(this,e),s(this,"WlUm","ALL"),s(this,"hMLn",[]),s(this,"FpUx",[]),s(this,"userAttributesValidated",!0),s(this,"sessionAttributeValidated",!0),s(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{if(n.WlUm=t.audience.audience_type,n.hMLn=t.audience.attributes.user,n.FpUx=t.audience.attributes.session,!Array.isArray(n.hMLn)||!Array.isArray(n.FpUx))return E.error("No attributes"),!1}catch(t){return E.error(t),!1}return!0})),s(this,"validate",(function(e,r){var i=!0;"FTU"===n.WlUm&&(i=t.getController().getSessionInfo().is_first_session);var a=n.hWBQ(e,n.hMLn),o=n.hWBQ(r,n.FpUx);return a||(n.userAttributesValidated=!1),o||(n.sessionAttributeValidated=!1),i&&a&&o})),s(this,"hWBQ",(function(t,e){var n=e.length,r=!0;try{for(var i,a=function(){var n=e[o];if(void 0===t[n.name]||!1===r)return{v:!1};var i=n.operator,a=n.type,s=n.value.map((function(t){if("s"===a)return t;if("l"===a)return parseInt(t);if("f"===a)return parseFloat(t);if("b"===a)switch(t){case"true":return!0;case"false":return!1}})),u=(Array.isArray(t[n.name])?t[n.name]:[t[n.name]]).some((function(t){return s.some((function(e){return"s"===a?t="".concat(t):"l"===a?t=parseInt(t):"f"===a?t=parseFloat(t):"b"===a&&(t=!!t),g(t,e,i)}))}));r=r&&u},o=0;o<n;o++)if(i=a())return i.v}catch(t){E.error(t),r=!1}return r}))})),w=window.ApxorLogger,S=o((function t(){var e=this;i(this,t),s(this,"tHcq",0),s(this,"Jnni",0),s(this,"DMUP","SESSION"),s(this,"iVEu",0),s(this,"nJim",0),s(this,"WYtP",0),s(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{e.tHcq=t.frequency.count,-1===e.tHcq&&(e.tHcq=1e3),e.WYtP=e.tHcq,e.Jnni=t.frequency.time_interval,e.DMUP=t.frequency.validity,e.nJim=t.frequency.ses_lmt,e._dayCount=t.frequency.day_lmt;var n=H.getInstance().getQeState();if(!d(n)||!d(n[t._id]))return!0;if("SESSION"===e.DMUP){if(e.tHcq=parseInt(e.tHcq)-parseInt(n[t._id].SESSION),e.tHcq<=0)return console.warn("Max count limit reached for session:"+t._id),!1}else{if("OVERALL"!==e.DMUP)return w.info("Invalid config."),!1;if(e.tHcq=parseInt(e.tHcq)-parseInt(n[t._id].OVERALL),e.tHcq<=0)return console.warn("Max count limit reached for overall:"+t._id),!1}}catch(t){return w.error(t),!1}return!0})),s(this,"gTMJ",(function(){e.tHcq=e.tHcq-1})),s(this,"getFrequencyCount",(function(){return e.tHcq})),s(this,"iucg",(function(){"SESSION"===e.DMUP&&(e.tHcq=e.WYtP,w.info("Campaign Limit reset"))})),s(this,"dUxW",(function(t){try{if(e.tHcq<=0)return!1;var n=H.getInstance().getQeState();if(!d(n)||!d(n[t]))return!0;if(0!==e.nJim)if(parseInt(e.nJim)-parseInt(n[t].SESSION)<=0)return!1;if(0!==e._dayCount){var r,i=m();if(parseInt(e._dayCount)-parseInt((null===(r=n[t])||void 0===r?void 0:r.DATES[i])||0)<=0)return!1}}catch(t){w.error("Error validating the frequency:"+t)}return!0}))})),k=o((function t(){var e=this;i(this,t),s(this,"syyb",""),s(this,"WlUm",""),s(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{var n,r;e.syyb=t.meta.name,e.WlUm=t.meta.type,e._only_context=t.meta.only_context,e._attr=(null===(n=t.meta)||void 0===n?void 0:n.attr)||{},e._isExperiment=null===(r=t.meta)||void 0===r?void 0:r.isExperiment}catch(t){return window.ApxorLogger.error(t),!1}return!0}))})),A=window.ApxorLogger,L=o((function t(){var e=this;i(this,t),s(this,"PJzo",-1),s(this,"EdWZ",-1),s(this,"nvNI",-1),s(this,"xRcY",-1),s(this,"XmRC",!1),s(this,"_nudge_expired",!1),s(this,"_not_yet_active",!1),s(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{if(isNaN(Date.parse(t.validity.start_date))||isNaN(Date.parse(t.validity.end_date)))return A.error("Not valid dates"),!1;if(e.PJzo=Date.parse(t.validity.start_date),e.EdWZ=Date.parse(t.validity.end_date),d(t.time_limits_in_day)&&(e.XmRC=t.time_limits_in_day,e.XmRC&&d(t.time_limits))){var n=(new Date).toISOString().split("T")[0];if(e.nvNI=Date.parse(n+"T"+t.time_limits.start_time+".000Z"),e.xRcY=Date.parse(n+"T"+t.time_limits.end_time+".000Z"),isNaN(e.nvNI)||isNaN(e.xRcY))return A.error("Not valid times"),!1}}catch(t){return A.error(t),!1}return!0})),s(this,"validate",(function(){var t=Date.now();return t>e.PJzo&&t<e.EdWZ?!e.XmRC||t>=e.nvNI&&t<=e.xRcY:(t<e.PJzo?e._not_yet_active=!0:t>e.EdWZ&&(e._nudge_expired=!0),!1)}))})),N=o((function t(){var e=this;i(this,t),s(this,"syyb",""),s(this,"Oykw",{}),s(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{e.syyb=t.name,e.Oykw=t.additional_info}catch(t){return!1}return!0}))})),R=o((function t(){var e=this;i(this,t),s(this,"gySt",0),s(this,"sJMt",0),s(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{if(e.gySt=Number(t.lower),e.sJMt=Number(t.upper),isNaN(e.gySt)||isNaN(e.sJMt))return!1}catch(t){return!1}return!0}))})),G=o((function t(){var e=this;i(this,t),s(this,"lvxP",0),s(this,"uhRx",""),s(this,"OVxL",""),s(this,"LusY",new N),s(this,"zhij",new R),s(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{return e.uhRx=t.event_type,e.OVxL=t.activity,e.LusY.parse(t.details)&&e.zhij.parse(t.time_bounds)}catch(t){return!1}}))})),B=window.ApxorLogger,O=o((function t(){var e=this;i(this,t),s(this,"lvxP",0),s(this,"HhMZ",-1),s(this,"tHcq",0),s(this,"cTPq",""),s(this,"OVxL",""),s(this,"uhRx",""),s(this,"zhij",new R),s(this,"LusY",new N),s(this,"VQnw",new G),s(this,"dxsU","AND"),s(this,"xYCJ",!1),s(this,"WlUm",void 0),s(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{return e.HhMZ=t.sequence,e.tHcq=t.count_config.count,e.cTPq=t.count_config.operator,e.OVxL=t.activity,e.uhRx=t.event_type,e.dxsU=t.combine_operator,e.WlUm=t.type,e.LusY.parse(t.details)&&e.VQnw.parse(t.trigger)&&e.zhij.parse(t.time_bounds)}catch(t){return B.error(t),!1}}))})),T=window.ApxorLogger,U=o((function t(){var e=this;i(this,t),s(this,"tHcq",0),s(this,"cTPq",""),s(this,"uhRx",""),s(this,"zhij",new R),s(this,"LusY",new N),s(this,"dxsU","AND"),s(this,"parse",(function(t){try{return e.tHcq=t.count_config.count,e.cTPq=t.count_config.operator,e.uhRx=t.event_type,e.dxsU=t.combine_operator,e.LusY.parse(t.details)&&e.zhij.parse(t.time_bounds)}catch(t){return T.error(t),!1}}))})),q=window.ApxorLogger,V=function(){function e(){var n=this;i(this,e),s(this,"zoso",0),s(this,"lpKr",""),s(this,"KBXV",new O),s(this,"ykBf",new U),s(this,"uZuR",!1),s(this,"Bawx",!1),s(this,"HRaN",0),s(this,"dxsU","AND"),s(this,"mgkZ","OR"),s(this,"zbsJ",-1),s(this,"qGXj",[]),s(this,"qWqw",{}),s(this,"UkgQ",!1),s(this,"initialize",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";if(n.lpKr=r,n.HRaN=i,n.qGXj=o,"termination"===s&&""!==s){n.ykBf.parse(e);return n.mgkZ=n.ykBf.dxsU,n.VScW(),!0}var u=n.KBXV.parse(e);if(u){if(n.dxsU=n.KBXV.dxsU,n.KBXV.xYCJ){var l=n.KBXV.LusY.syyb;"APX_PAGE_OPENED"===l&&(l=n.KBXV.LusY.Oykw.navigation_id,l=d(l)?l:n.KBXV.LusY.syyb),n.zbsJ=t.getController().getEventCount(l);var c=n.KBXV.tHcq,h=n.KBXV.cTPq;if(n.Bawx=n.CAsU(n.zbsJ-1,c,h,!1),n.uZuR=n.Bawx,n.Bawx&&"APX_PAGE_OPENED"===n.KBXV.LusY.syyb)return!0}return a&&0!==i||n.ffDP(),!0}return!1})),s(this,"ffDP",(function(){var t,e=n.KBXV,r=e.VQnw,i=H.getInstance();"app_start"===r.uhRx?(n.uZuR=!0,i.registerForEvent(f(e.uhRx)+"___"+e.LusY.syyb,n.wGcn)):i.registerForEvent(f(e.uhRx)+"___"+r.LusY.syyb,n.wGcn),null!==(t=window.ApxorRTM)&&void 0!==t&&t.badgesLists.includes(n.lpKr)&&i.registerForEvent(f(e.uhRx)+"___"+"apxor-badge-container-".concat("-".concat(n.lpKr).replaceAll(" ","").replace(/[^\w\s]/gi,"")),n.wGcn)})),s(this,"VScW",(function(){var t=n.ykBf,e=H.getInstance();n.uZuR=!0,e.registerForEvent(f(t.uhRx)+"___"+t.LusY.syyb,n.tTQi)})),s(this,"WRoy",(function(t,e,r,i){var a,o=(Date.now()-n.qWqw[e])/1e3;(null===(a=n.KBXV)||void 0===a||null===(a=a.LusY)||void 0===a||null===(a=a.Oykw)||void 0===a?void 0:a.time)/1e3>o&&n._displayCampaign(r)})),s(this,"EaLn",(function(t,e,r,i){var a,o;n.UkgQ=!0;var s=Date.now(),u=null===(a=n.KBXV)||void 0===a||null===(a=a.VQnw)||void 0===a?void 0:a.LusY.syyb,l=(s-n.qWqw[u])/1e3,c=null===(o=n.KBXV)||void 0===o||null===(o=o.LusY)||void 0===o||null===(o=o.Oykw)||void 0===o?void 0:o.time;(c/=1e3)>l&&n._displayCampaign(r)})),s(this,"wGcn",(function(e,r,i,a){var o,s,u=H.getInstance();if(n.uZuR){if(null!==(o=window.ApxorRTM)&&void 0!==o&&o.isBadgePresent&&null!==(s=window.ApxorRTM)&&void 0!==s&&s.badgesLists.includes(n.lpKr)&&t.getController().isBadgeTriggerSatisfied(n.lpKr))return n.Bawx=!0,n.KBXV.lvxP=i,void u.validate(n.lpKr,n.HRaN);f(n.KBXV.uhRx)===e&&n.bmYM(i-n.KBXV.VQnw.lvxP,n.KBXV.zhij)&&n.KBXV.LusY.syyb===r&&n.iapi(n.KBXV.LusY.Oykw,a)&&(n.zoso+=1,n.Bawx=n.CAsU(n.zoso,n.KBXV.tHcq,n.KBXV.cTPq),n.Bawx&&(n.KBXV.lvxP=i,u.validate(n.lpKr,n.HRaN)))}else if(n.uZuR=n.hBze(e,r,i,a),n.uZuR){var l=n.KBXV,c=l.VQnw;if(c.lvxP=i,"activity_time"===(null==l?void 0:l.uhRx)){var d,h,v,p=null==l||null===(d=l.LusY)||void 0===d||null===(d=d.Oykw)||void 0===d?void 0:d.time;(null==l||null===(h=l.LusY)||void 0===h||null===(h=h.Oykw)||void 0===h?void 0:h.nkpi.length)>0&&(setTimeout((function(){n.UkgQ||(n.Bawx=!0,n.Bawx&&(n.zoso+=1,n.Bawx=n.CAsU(n.zoso,n.KBXV.tHcq,n.KBXV.cTPq),n.Bawx&&(n.KBXV.lvxP=i,u.validate(n.lpKr,n.HRaN)))),l.LusY.Oykw.nkpi.map((function(t){u.unregisterFromEvent(_(l.LusY.Oykw.et)+"___"+t,n)}))}),p),l.LusY.Oykw.nkpi.map((function(t){u.registerForEvent(_(l.LusY.Oykw.et)+"___"+t,n.EaLn)}))),(null==l||null===(v=l.LusY)||void 0===v||null===(v=v.Oykw)||void 0===v?void 0:v.kpi.length)>0&&(setTimeout((function(){l.LusY.Oykw.kpi.map((function(t){u.unregisterFromEvent(_(l.LusY.Oykw.et)+"___"+t,n)}))}),p),l.LusY.Oykw.kpi.map((function(t){t===l.VQnw.LusY.syyb?(u.unregisterFromEvent(f(c.uhRx)+"___"+c.LusY.syyb,n),u.registerForEvent(_(l.LusY.Oykw.et)+"___"+t,n.WRoy)):u.registerForEvent(_(l.LusY.Oykw.et)+"___"+t,n.EaLn)})))}else u.unregisterFromEvent(f(c.uhRx)+"___"+c.LusY.syyb,n),u.registerForEvent(f(l.uhRx)+"___"+l.LusY.syyb,n);n.qWqw[r]=Date.now()}})),s(this,"tTQi",(function(t,e,r,i){var a=H.getInstance();f(n.ykBf.uhRx)===t&&n.bmYM(r,n.ykBf.zhij)&&n.ykBf.LusY.syyb===e&&n.iapi(n.ykBf.LusY.Oykw,i)&&(n.zoso+=1,n.Bawx=n.CAsU(n.zoso,n.ykBf.tHcq,n.ykBf.cTPq),n.Bawx&&(n.ykBf.lvxP=r,a.validateForTermination(n.lpKr,n.HRaN)))})),s(this,"hBze",(function(t,e,r,i){var a=n.KBXV.VQnw;return f(a.uhRx)===t&&a.LusY.syyb===e&&n.bmYM(r,a.zhij)&&n.iapi(a.LusY.Oykw,i)})),s(this,"bmYM",(function(t,e){var n=Math.ceil(t);return n>e.gySt&&n<e.sJMt})),s(this,"CAsU",(function(t,e,r){var i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];switch(i&&n.KBXV.xYCJ&&(t+=n.zbsJ),r){case"EQ":return t===e;case"GT":return t>e;case"GTE":return t>=e;case"LT":return t<e;case"LTE":return t<=e;default:return!1}})),s(this,"iapi",(function(t,e){var n=!0;try{var i,a=function(){if(!e[o]||!1===n)return{v:!1};if("object"===r(t[o])){var i,a=t[o].op,s=t[o].t;"s"===s?i=t[o].val:"l"!==s&&"f"!==s||(i=parseFloat(t[o].val));var u=(Array.isArray(e[o])?e[o]:[e[o]]).some((function(t){return g(t,i,a)}));n=n&&u}else n=n&&g(e[o],t[o],"EQ")};for(var o in t)if(i=a())return i.v}catch(t){q.error(t),n=!1}return n}))}return o(e,[{key:"_displayCampaign",value:function(t){var e=H.getInstance();this.Bawx=!0,this.Bawx&&(this.zoso+=1,this.Bawx=this.CAsU(this.zoso,this.KBXV.tHcq,this.KBXV.cTPq),this.Bawx&&(this.KBXV.lvxP=t,e.validate(this.lpKr,this.HRaN)))}}]),e}(),C=window.ApxorLogger,D=o((function e(){var n=this;i(this,e),s(this,"Naga",[]),s(this,"_ret_day",{}),s(this,"EgaN",{}),s(this,"npfl",!1),s(this,"EGPa",!1),s(this,"retainedDaysValidated",!0),s(this,"retainedSessionValidated",!0),s(this,"eventDoneInLT",!1),s(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{n.Naga=t.overall_cfg.events,n._ret_day=t.overall_cfg.ret_day,n.EgaN=t.overall_cfg.session,n.npfl=t.overall_cfg.toggleRetDay,n.EGPa=t.overall_cfg.toggleSession}catch(t){return C.error(t),!1}return!0})),s(this,"validate",(function(){var e=parseInt(t.getController().getFromStorage("apx_retained_days")),r=parseInt(t.getController().getFromStorage("apx_retained_session"));if(n.npfl&&!isNaN(e)&&!(e>=n._ret_day.from&&e<=n._ret_day.to))return n.retainedDaysValidated=!1,!1;if(n.EGPa&&!isNaN(r)&&!(r>=n.EgaN.from&&r<=n.EgaN.to))return n.retainedSessionValidated=!1,!1;try{for(var i=t.getController().getFromStorage("_apx_lt_count"),a=t.getSiteId(),o=JSON.parse((new TextDecoder).decode(function(t){for(var e=new ArrayBuffer(t.length),n=new Uint8Array(e),r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return e}(p(a,i)))),s=0;s<n.Naga.length;s++){if(o[n.Naga[s].name.replace("'","").replace("’","")])return n.eventDoneInLT=!0,!1}}catch(t){C.error("Failed to validate the lt count:"+t)}return!0}))})),K=window.ApxorLogger,Y=o((function t(){var e=this;i(this,t),s(this,"hMLn",[]),s(this,"FpUx",[]),s(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{if(e.hMLn=t.attributes.user,e.FpUx=t.attributes.session,!Array.isArray(e.hMLn)||!Array.isArray(e.FpUx))return K.error("No attributes"),!1}catch(t){return K.error(t),!1}return!0})),s(this,"validate",(function(t,n){return e.hWBQ(t,e.hMLn)&&e.hWBQ(n,e.FpUx)})),s(this,"hWBQ",(function(t,e){var n=e.length,r=!0;try{for(var i,a=function(){var n=e[o];if(!t[n.name]||!1===r)return{v:!1};var i=n.operator,a=n.type,s=n.value.map((function(t){return"s"===a?t:"l"===a?parseInt(t):"f"===a?parseFloat(t):void 0})),u=(Array.isArray(t[n.name])?t[n.name]:[t[n.name]]).some((function(t){return s.some((function(e){return g(t,e,i)}))}));r=r&&u},o=0;o<n;o++)if(i=a())return i.v}catch(t){K.error(t),r=!1}return r}))})),P=o((function e(){var n=this;i(this,e),s(this,"hNpn",t.getController()),s(this,"type",""),s(this,"_duration_seconds",0),s(this,"xQWn",1),s(this,"parse",(function(t){try{var e,r,i;if(n.WlUm=null===(e=t.terminate_info.time_based)||void 0===e?void 0:e.type,n._duration_seconds=null===(r=t.terminate_info)||void 0===r?void 0:r.time_based.duration_seconds,n.xQWn=null===(i=t.terminate_info.time_based)||void 0===i?void 0:i.days,n.JLlf(t._id))return n.hNpn.persistTerminationInfoLocally(t._id),!1}catch(t){return!1}return!0})),s(this,"JLlf",(function(t){var e,r=JSON.parse(n.hNpn.getFromStorage("apx_termination_ID"));if(!r[t]||null===(e=r[t])||void 0===e||!e.startDate)return!1;var i,a=new Date(r[t].startDate),o=new Date((i=new Date).getMonth()+"/"+i.getDate()+"/"+i.getFullYear()),s=parseInt((o-a)/864e5,10),u=function(){var t=new Date;return{hours:t.getHours(),mins:t.getMinutes()}}(),l=r[t].nvNI;return s===n.xQWn&&u.hours>=l.hours||s>n.xQWn||r[t].goalAcheived}))})),M=o((function t(){var e=this;i(this,t),s(this,"enable_goal_events",!1),s(this,"attributes",{}),s(this,"EPwY",new Y),s(this,"WQbc",new P),s(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{var n,r,i;if(e.enable_time_based=null==t||null===(n=t.terminate_info)||void 0===n?void 0:n.enable_time_based,e.enable_time_based&&!e.WQbc.parse(t))return!1;if(e.enable_goal_events=null==t||null===(r=t.terminate_info)||void 0===r?void 0:r.enable_goal_events,e.enable_attributes=null==t||null===(i=t.terminate_info)||void 0===i?void 0:i.enable_attributes,e.enable_attributes&&!e.EPwY.parse(t.terminate_info))return!1}catch(t){return window.ApxorLogger.error(t),!1}return!0})),s(this,"validate",(function(t,n){return e.EPwY.validate(t,n)}))})),F=o((function t(){var e=this;i(this,t),s(this,"LMkA",""),s(this,"yxAx",""),s(this,"KnBh",""),s(this,"BROX",""),s(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{return e.LMkA=null==t?void 0:t.screen_binding,!e.LMkA||(e.yxAx=null==t?void 0:t.binding.url,e.KnBh=null==t?void 0:t.binding.var,e.BROX=null==t?void 0:t.binding.operator,!0)}catch(t){return window.ApxorLogger.error(t),!1}})),s(this,"validate",(function(){var t=e.yxAx,n=e.KnBh,r=e.BROX,i=window.location.href;return!e.LMkA||("EQ"===r?t.includes(n)?!!x(i,t,n,!1):i===t:"SW"===r?t.includes(n)?!!x(i,t,n,!0):!!i.startsWith(t):void 0)}))})),I=window.ApxorLogger,Q=o((function e(){var r=this;i(this,e),s(this,"vQRv",[]),s(this,"GobL",[]),s(this,"lpKr",""),s(this,"EGkt",new k),s(this,"bMmw",new b),s(this,"DMUP",new L),s(this,"rLwm",new S),s(this,"UbNe",new D),s(this,"olXY",new M),s(this,"Mizq",new F),s(this,"hSuB",!1),s(this,"iwnb",[]),s(this,"_variant_code",""),s(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{var e;if(!d(t._id))return I.error("No Id"),!1;if(!d(t.enabled)||!t.enabled)return I.error("Not enabled"),!1;if(!(r.EGkt.parse(t)&&r.DMUP.parse(t)&&r.rLwm.parse(t)&&r.bMmw.parse(t)&&r.UbNe.parse(t)&&r.olXY.parse(t)&&r.Mizq.parse(t)))return!1;if(r._variant_code=r.EGkt._isExperiment||r.EGkt._only_context?null===(e=r.EGkt._attr)||void 0===e?void 0:e.apx_variant_code:"TG",!d(t.conditions)||!Array.isArray(t.conditions))return I.error("No valid conditions",t.conditions),!1;r.lpKr=t._id,r.hSuB=!!d(t.sequence_enabled)&&t.sequence_enabled,r.hSuB&&t.conditions.sort((function(t,e){return t.sequence<e.sequence}));for(var n=t.conditions,i=n.length,a=0;a<i;a++){r.iwnb=[];var o=n[a];if("didn't"===o.type){var s,l={trigger_key:o.trigger.details.name,no_kpi_array:null==o||null===(s=o.details)||void 0===s||null===(s=s.additional_info)||void 0===s?void 0:s.nkpi,condition_id:null==o?void 0:o._id,time_bounds:o.time_bounds.upper};r.iwnb=[].concat(u(r.iwnb),[l])}var c=new V;c.initialize(o,r.lpKr,a,r.hSuB,r.iwnb)&&r.vQRv.push(c)}if(r.olXY.enable_goal_events)for(var h=t.terminate_info.goal_events.events,v=h.length,p=0;p<v;p++){var f=new V;f.initialize(h[p],r.lpKr,p,!0,[],"termination")&&r.GobL.push(f)}return r.vQRv.length>0}catch(t){return I.error(t),!1}})),s(this,"zGOs",(function(t){if(!(t<0))if(r.hSuB){var e=r.vQRv[t];if(d(e)&&e.Bawx){var n=r.vQRv[t-1];if(d(n)&&!n.Bawx)return;var i=r.vQRv[t+1];d(i)?i.ffDP():r.oFyJ()}}else r.oFyJ()})),s(this,"faWE",(function(t){t<0||r.KGqD()})),s(this,"oFyJ",(function(){var e=t.getController().getUserAttributes(),i=t.getController().getSessionAttributes();if(!(r.DMUP.validate()&&r.bMmw.validate(e,i)&&r.UbNe.validate()&&r.Mizq.validate()))return r.UbNe.retainedDaysValidated||null==t||t.logEvent("apx_non_eligible_user",{apx_nudge_type:"SURVEY"===r.EGkt.WlUm?"survey":"campaign",apx_nudge_id:r.lpKr,apx_nudge_name:r.EGkt.syyb,apx_variant_code:r.EGkt._isExperiment||r.EGkt._only_context?r.EGkt._attr.apx_variant_code:"TG",apx_failure_type:"warn",apx_reason:"Retained day criteria not met"}),r.UbNe.retainedSessionValidated||null==t||t.logEvent("apx_non_eligible_user",{apx_nudge_type:"SURVEY"===r.EGkt.WlUm?"survey":"campaign",apx_nudge_id:r.lpKr,apx_nudge_name:r.EGkt.syyb,apx_variant_code:r.EGkt._isExperiment||r.EGkt._only_context?r.EGkt._attr.apx_variant_code:"TG",apx_failure_type:"warn",apx_reason:"User session criteria not met"}),r.UbNe.eventDoneInLT&&(null==t||t.logEvent("apx_non_eligible_user",{apx_nudge_type:"SURVEY"===r.EGkt.WlUm?"survey":"campaign",apx_nudge_id:r.lpKr,apx_nudge_name:r.EGkt.syyb,apx_variant_code:r.EGkt._isExperiment||r.EGkt._only_context?r.EGkt._attr.apx_variant_code:"TG",apx_failure_type:"warn",apx_reason:"Event done in life time"})),r.bMmw.userAttributesValidated||null==t||t.logEvent("apx_non_eligible_user",{apx_nudge_type:"SURVEY"===r.EGkt.WlUm?"survey":"campaign",apx_nudge_id:r.lpKr,apx_nudge_name:r.EGkt.syyb,apx_variant_code:r.EGkt._isExperiment||r.EGkt._only_context?r.EGkt._attr.apx_variant_code:"TG",apx_failure_type:"warn",apx_reason:"User property filter not met"}),r.bMmw.sessionAttributeValidated||null==t||t.logEvent("apx_non_eligible_user",{apx_nudge_type:"SURVEY"===r.EGkt.WlUm?"survey":"campaign",apx_nudge_id:r.lpKr,apx_nudge_name:r.EGkt.syyb,apx_variant_code:r.EGkt._isExperiment||r.EGkt._only_context?r.EGkt._attr.apx_variant_code:"TG",apx_failure_type:"warn",apx_reason:"Session property filter not met"}),r.DMUP._not_yet_active&&(null==t||t.logEvent("apx_non_eligible_user",{apx_nudge_type:"SURVEY"===r.EGkt.WlUm?"survey":"campaign",apx_nudge_id:r.lpKr,apx_nudge_name:r.EGkt.syyb,apx_variant_code:r.EGkt._isExperiment||r.EGkt._only_context?r.EGkt._attr.apx_variant_code:"TG",apx_failure_type:"warn",apx_reason:"nudge not yet active"})),void(r.DMUP._nudge_expired&&(null==t||t.logEvent("apx_non_eligible_user",{apx_nudge_type:"SURVEY"===r.EGkt.WlUm?"survey":"campaign",apx_nudge_id:r.lpKr,apx_nudge_name:r.EGkt.syyb,apx_variant_code:r.EGkt._isExperiment||r.EGkt._only_context?r.EGkt._attr.apx_variant_code:"TG",apx_failure_type:"warn",apx_reason:"nudge expired"})));for(var a=r.vQRv.length,o=a<1,s="",u=0;u<a;u++){var l=r.vQRv[u],c=l.Bawx;if(""===s.trim())o=c;else switch(s){case"AND":o=o&&c;break;case"OR":o=o||c}s=l.dxsU}if(o){var d,h;if(console.debug("onCondition satisfied"),!r.rLwm.dUxW(r.lpKr))return console.warn("Maximum limit reached",r.lpKr),void(null==t||t.logEvent("apx_non_eligible_user",{apx_nudge_type:"campaign",apx_nudge_id:r.lpKr,apx_nudge_name:r.EGkt.syyb,apx_variant_code:r.EGkt._isExperiment||r.EGkt._only_context?r.EGkt._attr.apx_variant_code:"TG",apx_failure_type:"warn",apx_reason:"Campaign limit reached"}));null!==(d=window.ApxorRTM)&&void 0!==d&&d.isBadgePresent&&null!==(h=window.ApxorRTM)&&void 0!==h&&h.badgesLists.includes(r.lpKr)&&t.getController().isBadgeTriggerSatisfied(r.lpKr)||null==t||t.logEvent("apx_trigger_satisfied",{apx_nudge_type:"SURVEY"===r.EGkt.WlUm?"survey":"campaign",apx_nudge_id:r.lpKr,apx_nudge_name:r.EGkt.syyb,apx_variant_code:r.EGkt._isExperiment||r.EGkt._only_context?r.EGkt._attr.apx_variant_code:"TG"}),console.log("Dispatching event",r.EGkt.WlUm),!0===r.EGkt._only_context&&t.logEvent("apx_context_evaluated",n(n({},r.EGkt._attr),{},{message_name:r.EGkt.syyb,id:r.lpKr})),t.getController().dispatchEvent(r.EGkt.WlUm,{name:r.EGkt.WlUm,additional_info:{uuid:r.lpKr,name:r.EGkt.syyb}})}})),s(this,"KGqD",(function(){for(var e=r.GobL.length,i=e<1,a="",o=0;o<e;o++){var s=r.GobL[o],u=s.Bawx;if(""===a.trim())i=u;else switch(a){case"AND":i=i&&u;break;case"OR":i=i||u}a=s.mgkZ}i&&(console.log("Dispatching event",r.EGkt.WlUm),t.getController().persistTerminationInfoLocally(r.lpKr),!0===r.EGkt._only_context&&t.logEvent("apx_context_evaluated",n(n({},r.EGkt._attr),{},{message_name:r.EGkt.syyb,id:r.lpKr})),t.getController().dispatchEvent(r.EGkt.WlUm,{name:r.EGkt.WlUm,additional_info:{uuid:r.lpKr,name:r.EGkt.syyb}}))})),s(this,"validateForTerminationAttributes",(function(){var e=t.getController().getUserAttributes(),n=t.getController().getSessionAttributes();return r.olXY.validate(e,n)})),s(this,"gTMJ",(function(){r.rLwm.gTMJ()})),s(this,"getFrequencyCount",(function(){return r.rLwm.getFrequencyCount()})),s(this,"MpVI",(function(){return r.rLwm.iucg()}))})),W=o((function t(){var e=this;i(this,t),s(this,"ybSa",{}),s(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{configs:[]};if(d(t)&&d(t.configs)){var n=t.configs;if(!Array.isArray(n))return;n.sort((function(t,e){var n,r;return(null!==(n=t.prio)&&void 0!==n?n:-1)-(null!==(r=e.prio)&&void 0!==r?r:-1)}));for(var r=0;r<n.length;r++){var i=n[r],a=i._id,o=new Q;o.parse(i)?e.ybSa[a]=o:console.warn("Failed to parse cfg",a)}}})),s(this,"validate",(function(t,n){e.ybSa[t]&&e.ybSa[t].zGOs(n)})),s(this,"getVariantCode",(function(t){return e.ybSa[t]?e.ybSa[t]._variant_code:""})),s(this,"validateForTermination",(function(t,n){e.ybSa[t]&&e.ybSa[t].faWE(n)})),s(this,"validateForTerminationAttributes",(function(t){return!!e.ybSa[t]&&e.ybSa[t].validateForTerminationAttributes()})),s(this,"gTMJ",(function(t){e.ybSa[t].gTMJ()})),s(this,"getFrequencyCount",(function(t){return e.ybSa[t].getFrequencyCount()})),s(this,"resetFrequencyCounts",(function(){var t=e.ybSa;for(var n in t)t[n].MpVI()})),s(this,"vMvA",(function(t){try{if(e.ybSa){var n=e.ybSa[t];if(n&&n.EGkt)return n.EGkt}}catch(t){console.log("Error in getting the campaign meta ".concat(t))}return{}}))})),X=window.ApxorLogger,z=o((function e(){var n=this;i(this,e),s(this,"nNut",{}),s(this,"gyZv",[]),s(this,"pDqC",!1),s(this,"initialize",(function(){var e=t.getController();e.registerForEvent("APP_EVENT",(function(t){return n.IOaS(t,"AE")})),e.registerForEvent("CLIENT_EVENT",(function(t){return n.IOaS(t,"CE")}))})),s(this,"cwGi",(function(){for(var t in n.gyZv)n.Sfpe(t.event,t.key,t.type);n.pDqC=!0})),s(this,"sOYW",(function(t,e){var r;"function"==typeof e&&((r=n.nNut[t]?n.nNut[t]:[]).push(e),n.nNut[t]=r,X.debug("Listeners list: ",n.nNut))})),s(this,"unregisterFromEvent",(function(t,e){if(n.nNut[t]){for(var r=n.nNut[t],i=[],a=0;a<r.length;a++){var o=r[a];o!==e&&i.push(o)}n.nNut[t]=i}})),s(this,"IOaS",(function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"AE",r=e+"___"+t.name;n.Sfpe(t,r,e)})),s(this,"Sfpe",(function(e,r,i){if(n.pDqC){if(X.debug("Notifying listeners for event: "+e+", "+r,n.nNut),n.nNut[r])for(var a=n.nNut[r],o=t.getController().getSDKRunningTimeInSec(),s=0;s<a.length;s++){(0,a[s])(i,e.name,o,e.additional_info)}}else n.gyZv.push({event:e,key:r,type:i})}))})),j=window.ApxorLogger,H=function(){function e(){var n=this;return i(this,e),s(this,"Qhln",!1),s(this,"NXNu",null),s(this,"ExzS",m()),s(this,"vmQB",new z),s(this,"vTtW",t.getSiteId()),s(this,"pERi",{}),s(this,"getQeState",(function(){try{var e=t.getController().getFromStorage("qe_state");return e?JSON.parse(p(n.vTtW,e)):(n.pERi={},n.setQeState())}catch(t){return n.pERi={},n.setQeState()}})),s(this,"setQeState",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";try{t.getController().persistToStorage("qe_state",n.pERi,!0)}catch(r){""===e?n.pERi={}:n.pERi[e]={SESSION:0,OVERALL:0,DATES:{}},t.getController().persistToStorage("qe_state",n.pERi,!0)}return n.pERi})),s(this,"initialize",(function(){n.Qhln||(n.Qhln=!0,n.NXNu=new W,n.vmQB.initialize(),n.pERi=n.getQeState(),j.info("QE Initialized.."))})),s(this,"parse",(function(t){n.nRwD()?(n.NXNu.parse(t),n.vmQB.cwGi()):j.warn("Must call init first. Unable to proceed")})),s(this,"validate",(function(t,e){n.nRwD()&&n.NXNu.validate(t,e)})),s(this,"getVariantCode",(function(t){return n.NXNu.getVariantCode(t)})),s(this,"validateForTermination",(function(t,e){n.nRwD()&&n.NXNu.validateForTermination(t,e)})),s(this,"validateForTerminationAttributes",(function(t,e){return n.NXNu.validateForTerminationAttributes(t,e)})),s(this,"updateCount",(function(t){try{d(n.pERi[t])||n.createObjConfig(t),n.incrementFrequencies(t),n.setQeState(t),n.NXNu.gTMJ(t)}catch(t){console.log("Could not update the count config:".concat(t))}})),s(this,"resetFrequencyCounts",(function(){n.NXNu.resetFrequencyCounts()})),s(this,"getFrequencyCount",(function(t){return n.NXNu.getFrequencyCount(t)})),s(this,"registerForEvent",(function(t,e){n.vmQB.sOYW(t,e)})),s(this,"unregisterFromEvent",(function(t,e){n.vmQB.unregisterFromEvent(t,e)})),s(this,"notifyEventListener",(function(t){n.vmQB.IOaS(t)})),s(this,"fetch",(function(e,n,r,i){t.getController().fetchConfiguration(e,n,r,i)})),s(this,"nRwD",(function(){return n.Qhln})),s(this,"getCampaignMetaFromQueryEngine",(function(t){return n.NXNu.vMvA(t)})),s(this,"dIdu",(function(){return n.ExzS})),e.instance||(e.instance=this),e.instance}return o(e,[{key:"createObjConfig",value:function(t){try{this.pERi=this.getQeState(),d(this.pERi[t])||(this.pERi[t]={SESSION:0,OVERALL:0,DATES:{}},this.ExzS&&(this.pERi[t].DATES[this.ExzS]=0),this.setQeState(t))}catch(t){j.error("Can not create the frequency count object:"+t)}}},{key:"incrementFrequencies",value:function(t){this.pERi=this.getQeState();var e=this.pERi[t];e.SESSION=e.SESSION+1,e.OVERALL=e.OVERALL+1;var n=m();n===this.ExzS&&e.DATES&&e.DATES[n]||(this.ExzS=n,e.DATES={},e.DATES[this.ExzS]=0),e.DATES[this.ExzS]=e.DATES[this.ExzS]+1}}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}]),e}();s(H,"instance",void 0),window.ceVersion=151;try{void 0===exports&&null===exports||(exports.default=H,module.exports=exports.default)}catch(t){}return H}));
