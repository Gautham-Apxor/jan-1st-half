!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("apxor")):"function"==typeof define&&define.amd?define(["apxor"],t):(e=e||self)["apxor-qe"]=t(e.Apxor)}(this,(function(e){"use strict";function t(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function n(e){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?t(Object(i),!0).forEach((function(t){s(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):t(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,d(i.key),i)}}function a(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function s(e,t,n){return(t=d(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e){return function(e){if(Array.isArray(e))return v(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||u(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(e,t){if(e){if("string"==typeof e)return v(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?v(e,t):void 0}}function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function c(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=u(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function d(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}e=e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e;var g=function(e){return void 0===e},f=function(e){return void 0!==e&&!function(e){return null===e}(e)},_="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function h(e,t){return Array.from(t).map((function(t,n){return String.fromCharCode(t^function(e,t){return e.charCodeAt(Math.floor(t%e.length))}(e,n))})).join("")}var p=function(e,t){return h(e,t=function(e){var t,n,i,r,o,a,s=0,l=[];if(!e)return e;e+="";do{t=(a=_.indexOf(e.charAt(s++))<<18|_.indexOf(e.charAt(s++))<<12|(r=_.indexOf(e.charAt(s++)))<<6|(o=_.indexOf(e.charAt(s++))))>>16&255,n=a>>8&255,i=255&a,l.push(t),64!==r&&(l.push(n),64!==o&&l.push(i))}while(s<e.length);return l}(t))},m=function(e){switch(e){case"app_event":return"AE";case"client_event":return"CE";case"activity_time":case"activity_event":return"AE";case"apxor_event":return"AEV";case"customer_event":return"CEV";case"any_event":return"ANV";case"campaign_event":return"CNV";case"survey_event":return"SVE"}return"Unknown"},y=function(e){return e.toUpperCase()},w=function(e,t,n){switch(n){case"EQ":return e===t;case"GT":return e>t;case"GTE":return e>=t;case"LT":return e<t;case"LTE":return e<=t;case"NEQ":return e!==t;case"R":return b(t).test(e);default:return!1}},x=function(e,t){switch(e){case"second":return 1e3*t;case"minute":return 60*t*1e3;case"hour":return 60*t*60*1e3;case"day":return 24*t*60*60*1e3;default:return 1}},b=function(e){var t=e.replace(/.*\/([gimuy]*)$/,"$1");t===e&&(t="");var n=t?e.replace(new RegExp("^/(.*?)/"+t+"$"),"$1"):e;return new RegExp(n,t)},A=function(){var e=new Date;return e.getDate()+"/"+e.getMonth()+"/"+e.getFullYear()},E=window.ApxorLogger,N=a((function t(){var n=this;r(this,t),s(this,"ihHi","ALL"),s(this,"AVOu",[]),s(this,"sGkC",[]),s(this,"userAttributesValidated",!0),s(this,"sessionAttributeValidated",!0),s(this,"parse",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{if(n.ihHi=e.audience.audience_type,n.AVOu=e.audience.attributes.user,n.sGkC=e.audience.attributes.session,!Array.isArray(n.AVOu)||!Array.isArray(n.sGkC))return E.error("No attributes"),!1}catch(e){return E.error(e),!1}return!0})),s(this,"validate",(function(t,i){var r=!0;"FTU"===n.ihHi&&(r=e.getController().getSessionInfo().is_first_session);var o=n.yDYz(t,n.AVOu),a=n.yDYz(i,n.sGkC);return o||(n.userAttributesValidated=!1),a||(n.sessionAttributeValidated=!1),r&&o&&a})),s(this,"yDYz",(function(e,t){var n=t.length,i=!0;try{for(var r,o=function(){var n=t[a];if(g(e[n.name])||!1===i)return{v:!1};var r=n.operator,o=n.type,s=n.value.map((function(e){if("s"===o)return e;if("l"===o)return parseInt(e);if("f"===o)return parseFloat(e);if("b"===o)switch(e){case"true":return!0;case"false":return!1;default:return e}})),l=(Array.isArray(e[n.name])?e[n.name]:[e[n.name]]).some((function(e){return s.some((function(t){return"s"===o?e="".concat(e):"l"===o?e=parseInt(e):"f"===o?e=parseFloat(e):"b"===o&&(e=!!e),w(e,t,r)}))}));i=i&&l},a=0;a<n;a++)if(r=o())return r.v}catch(e){E.error(e),i=!1}return i}))})),G=a((function e(){var t=this;r(this,e),s(this,"zGIt",""),s(this,"GIXJ",{}),s(this,"BsyB",""),s(this,"parse",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{t.zGIt=e.name,t.GIXJ=e.additional_info,t.BsyB=null==e?void 0:e.path}catch(e){return!1}return!0}))})),k=a((function e(){var t=this;r(this,e),s(this,"uxFs",0),s(this,"hjiW",0),s(this,"parse",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{if(t.uxFs=Number(e.lower),t.hjiW=Number(e.upper),isNaN(t.uxFs)||isNaN(t.hjiW))return!1}catch(e){return!1}return!0}))})),I=a((function e(){var t=this;r(this,e),s(this,"IqFs",0),s(this,"NnlN",""),s(this,"nYde",""),s(this,"YnAb",new G),s(this,"ZzIB",new k),s(this,"parse",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{return t.NnlN=e.event_type,t.nYde=e.activity,t.YnAb.parse(e.details)&&t.ZzIB.parse(e.time_bounds)}catch(e){return!1}}))})),Y=window.ApxorLogger,C=a((function e(){var t=this;r(this,e),s(this,"IqFs",0),s(this,"MFgV",-1),s(this,"deYH",0),s(this,"mYCN",""),s(this,"nYde",""),s(this,"NnlN",""),s(this,"ZzIB",new k),s(this,"YnAb",new G),s(this,"YYjm",new I),s(this,"Rflv","AND"),s(this,"DUvP",!1),s(this,"ihHi",void 0),s(this,"MHBj",""),s(this,"parse",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{var n,i;return t.MFgV=null==e?void 0:e.sequence,t._conditionType=null==e?void 0:e.condition_type,t._id=null==e?void 0:e._id,t._eventCategory=null!=e&&e.event_category?null==e?void 0:e.event_category:"specific_event",t.deYH=null==e||null===(n=e.count_config)||void 0===n?void 0:n.count,t.mYCN=null==e||null===(i=e.count_config)||void 0===i?void 0:i.operator,t.nYde=null==e?void 0:e.activity,t.NnlN=null==e?void 0:e.event_type,t.Rflv=e.combine_operator,t._timeEnabled=null==e?void 0:e.time_enabled,t._time=null==e?void 0:e.time,t.ihHi=null==e?void 0:e.type,t.MHBj=null==e?void 0:e.route,t.YnAb.parse(null==e?void 0:e.details)&&t.YYjm.parse(e.trigger)&&t.ZzIB.parse(e.time_bounds)}catch(e){return Y.error(e),!1}}))})),W=window.ApxorLogger,F=a((function e(){var t=this;r(this,e),s(this,"deYH",0),s(this,"mYCN",""),s(this,"NnlN",""),s(this,"ZzIB",new k),s(this,"YnAb",new G),s(this,"Rflv","AND"),s(this,"parse",(function(e){try{return t.deYH=e.count_config.count,t.mYCN=e.count_config.operator,t.NnlN=e.event_type,t.Rflv=e.combine_operator,t.YnAb.parse(e.details)&&t.ZzIB.parse(e.time_bounds)}catch(e){return W.error(e),!1}}))})),O=window.ApxorLogger,T=function(){function t(){var n=this;r(this,t),s(this,"gvYi",0),s(this,"VgQE",""),s(this,"rWxw",new C),s(this,"KyEg",new F),s(this,"LpfT",!1),s(this,"xybO",!1),s(this,"PvKO",0),s(this,"Rflv","AND"),s(this,"elly","OR"),s(this,"qCDF",-1),s(this,"TtoS",[]),s(this,"RdsQ",{}),s(this,"jpEw",!1),s(this,"knai",void 0),s(this,"bjhS",void 0),s(this,"GZwK",void 0),s(this,"AvEL",void 0),s(this,"no_KPI_TriggerDetails",[]),s(this,"fFdf",!1),s(this,"timerDidnt",void 0),s(this,"timerDid",void 0),s(this,"initialize",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],s=arguments.length>5&&void 0!==arguments[5]&&arguments[5],l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"",u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:-1,v=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];if(n.VgQE=i,n.PvKO=r,n.TtoS=a,n.knai=o,n.childConditionIndex=u,n.across_sessions=s||!1,"termination"===l&&""!==l){n.KyEg.parse(t);return n.elly=n.KyEg.Rflv,n.HrZo(),!0}var c=n.rWxw.parse(t);if(c){if(n.Rflv=n.rWxw.Rflv,n.rWxw.DUvP){var d=n.rWxw.YnAb.zGIt;"APX_PAGE_OPENED"===d&&(d=n.rWxw.YnAb.GIXJ.navigation_id,d=f(d)?d:n.rWxw.YnAb.zGIt),n.qCDF=e.getController().getEventCount(d);var g=n.rWxw.deYH,_=n.rWxw.mYCN;if(n.xybO=n.PuHd(n.qCDF-1,g,_,!1),n.LpfT=n.xybO,n.xybO&&"APX_PAGE_OPENED"===n.rWxw.YnAb.zGIt)return!0}return!0===v&&(o&&0!==r&&"unordered"!==o||n.bBZB()),!0}return!1})),s(this,"bBZB",(function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;-1!=t&&(n.bjhS=t);var i=n.rWxw,r=null!=i&&i._eventCategory?null==i?void 0:i._eventCategory:"specific_event",o=i.YYjm,a=ee.getInstance();if("app_start"===o.NnlN)if(n.LpfT=!0,null!=i&&i._timeEnabled){if("session"!=(null==i?void 0:i._time.unit)){var s=x(i._time.unit,i._time.value);if("didn't"==(null==i?void 0:i.ihHi)){if(n.jpEw=!1,console.log("in didnt"),console.log("in bBZB didn't"),n.timerDidnt=setTimeout((function(){console.log("setTimeout timer compleetd"),n.jpEw||(n.xybO=!0,n.xybO&&(n.gvYi+=1,n.xybO=n.PuHd(n.gvYi,n.rWxw.deYH,n.rWxw.mYCN),n.xybO&&(n.rWxw.IqFs=Date.now(),a.validate(n.VgQE,n.PvKO,n.bjhS))),"specific_event"===r?a.unregisterFromEvent(m(n.rWxw.NnlN)+"___"+n.rWxw.YnAb.zGIt,n.kuNq):n.FkkG(r),n.LpfT=!1)}),s),n.across_sessions){var l=x(i._time.unit,i._time.value),u=i._timeEnabled,v=i._id;n.sAMr(i.ihHi,i.YnAb.zGIt,Date.now(),i.YnAb.GIXJ,l,u,v)}"specific_event"===r?(a.registerForEvent(m(n.rWxw.NnlN)+"___"+n.rWxw.YnAb.zGIt,n.kuNq),n.AvEL=n.rWxw):n.XAje(r)}else if("did"==(null==i?void 0:i.ihHi)){if(console.log("did condition"),n.timerDid=setTimeout((function(){n.fFdf||("specific_event"===r?a.unregisterFromEvent(m(n.rWxw.NnlN)+"___"+n.rWxw.YnAb.zGIt,n.Cwga):n.jMbU(r))}),s),n.across_sessions){var c=x(i._time.unit,i._time.value),d=i._timeEnabled,g=i._id;n.sAMr(i.ihHi,i.YnAb.zGIt,Date.now(),i.YnAb.GIXJ,c,d,g)}"specific_event"===r?(a.registerForEvent(m(n.rWxw.NnlN)+"___"+n.rWxw.YnAb.zGIt,n.Cwga),n.GZwK=n.rWxw):n.wLWa(r)}}}else console.log("on receive event1"),"specific_event"===r?a.registerForEvent(m(i.NnlN)+"___"+i.YnAb.zGIt,n.WIIa):n.Cbqq(r);else if(null!=i&&i._timeEnabled){if("session"!=(null==i?void 0:i._time.unit)){var f=x(i._time.unit,i._time.value);"didn't"==(null==i?void 0:i.ihHi)?(n.jpEw=!1,n.timerDidnt=setTimeout((function(){n.jpEw||(n.xybO=!0,n.xybO&&(n.gvYi+=1,n.xybO=n.PuHd(n.gvYi,n.rWxw.deYH,n.rWxw.mYCN),n.xybO&&(n.rWxw.IqFs=Date.now(),a.validate(n.VgQE,n.PvKO)))),"specific_event"===r&&a.unregisterFromEvent(m(n.rWxw.NnlN)+"___"+n.rWxw.YnAb.zGIt,n.kuNq),n.LpfT=!1}),f),"specific_event"===r?(a.registerForEvent(m(n.rWxw.NnlN)+"___"+n.rWxw.YnAb.zGIt,n.kuNq),n.AvEL=n.rWxw):n.XAje()):"did"==(null==i?void 0:i.ihHi)&&(console.log("did condition"),n.timerDid=setTimeout((function(){n.fFdf||"specific_event"===r&&a.unregisterFromEvent(m(n.rWxw.NnlN)+"___"+n.rWxw.YnAb.zGIt,n.Cwga)}),f),"specific_event"===r&&a.registerForEvent(m(n.rWxw.NnlN)+"___"+n.rWxw.YnAb.zGIt,n.Cwga))}}else"specific_event"===r&&a.registerForEvent(m(i.NnlN)+"___"+o.YnAb.zGIt,n.WIIa);null!==(e=window.ApxorRTM)&&void 0!==e&&e.badgesLists.includes(n.VgQE)&&(console.log("on receive event3"),a.registerForEvent(m(i.NnlN)+"___"+"apxor-badge-container-".concat("-".concat(n.VgQE).replaceAll(" ","").replace(/[^\w\s]/gi,"")),n.WIIa))})),s(this,"Cbqq",(function(e){var t=new ee;"apxor_event"===e?t.registerForEvent("apxor_event",(function(e,t,i,r){n.WIIa(m(n.rWxw.NnlN),n.rWxw.YnAb.zGIt,i,n.rWxw.YnAb.GIXJ)})):"customer_event"===e?t.registerForEvent("customer_event",(function(e,t,i,r){n.WIIa(m(n.rWxw.NnlN),n.rWxw.YnAb.zGIt,i,n.rWxw.YnAb.GIXJ)})):"any_event"===e?t.registerForEvent("any_event",(function(e,t,i,r){n.WIIa(m(n.rWxw.NnlN),n.rWxw.YnAb.zGIt,i,n.rWxw.YnAb.GIXJ)})):"campaign_event"===e?t.registerForEvent("campaign_event",(function(e,t,i,r){n.WIIa(m(n.rWxw.NnlN),n.rWxw.YnAb.zGIt,i,n.rWxw.YnAb.GIXJ)})):"survey_event"===e&&t.registerForEvent("survey_event",(function(e,t,i,r){n.WIIa(m(n.rWxw.NnlN),n.rWxw.YnAb.zGIt,i,n.rWxw.YnAb.GIXJ)}))})),s(this,"FkkG",(function(e){console.log("in new bBZB");var t=new ee,i=n.rWxw._eventCategory;"apxor_event"===i?t.unregisterFromEvent("apxor_event",n.kuNq):"customer_event"===i?t.unregisterFromEvent("customer_event",n.kuNq):"any_event"===i?t.unregisterFromEvent("any_event",n.kuNq):"campaign_event"===i?t.unregisterFromEvent("campaign_event",n.kuNq):"survey_event"===i&&t.unregisterFromEvent("survey_event",n.kuNq)})),s(this,"XAje",(function(){console.log("in new bBZB");var e=new ee,t=n.rWxw._eventCategory;"apxor_event"===t?e.registerForEvent("apxor_event",n.kuNq):"customer_event"===t?e.registerForEvent("customer_event",n.kuNq):"any_event"===t?e.registerForEvent("any_event",n.kuNq):"campaign_event"===t?e.registerForEvent("campaign_event",n.kuNq):"survey_event"===t&&e.registerForEvent("survey_event",n.kuNq)})),s(this,"wLWa",(function(){var e=new ee,t=n.rWxw._eventCategory;"apxor_event"===t?e.registerForEvent("apxor_event",n.Cwga):"customer_event"===t?e.registerForEvent("customer_event",n.Cwga):"any_event"===t?e.registerForEvent("any_event",n.Cwga):"campaign_event"===t?e.registerForEvent("campaign_event",n.Cwga):"survey_event"===t&&e.registerForEvent("survey_event",n.Cwga)})),s(this,"jMbU",(function(){var e=new ee,t=n.rWxw._eventCategory;"apxor_event"===t?e.unregisterFromEvent("apxor_event",n.Cwga):"customer_event"===t?e.unregisterFromEvent("customer_event",n.Cwga):"any_event"===t?e.unregisterFromEvent("any_event",n.Cwga):"campaign_event"===t?e.unregisterFromEvent("campaign_event",n.Cwga):"survey_event"===t&&e.unregisterFromEvent("survey_event",n.Cwga)})),s(this,"HrZo",(function(){var e=n.KyEg,t=ee.getInstance();n.LpfT=!0,t.registerForEvent(m(e.NnlN)+"___"+e.YnAb.zGIt,n.ZgNh)})),s(this,"ASiy",(function(e,t,i,r){var o,a=(Date.now()-n.RdsQ[t])/1e3;(null===(o=n.rWxw)||void 0===o||null===(o=o.YnAb)||void 0===o||null===(o=o.GIXJ)||void 0===o?void 0:o.time)/1e3>a&&n._displayCampaign(i)})),s(this,"kiEG",(function(e,t,i,r){var o,a;n.jpEw=!0;var s=Date.now(),l=null===(o=n.rWxw)||void 0===o||null===(o=o.YYjm)||void 0===o?void 0:o.YnAb.zGIt,u=(s-n.RdsQ[l])/1e3,v=null===(a=n.rWxw)||void 0===a||null===(a=a.YnAb)||void 0===a||null===(a=a.GIXJ)||void 0===a?void 0:a.time;(v/=1e3)>u&&n._displayCampaign(i)})),s(this,"Cwga",(function(){n.fFdf=!0,console.log("configitem kpi check2");var e=new ee;clearTimeout(n.timerDid),n.gvYi+=1,n.xybO=n.PuHd(n.gvYi,n.rWxw.deYH,n.rWxw.mYCN),n.xybO&&(e.unregisterFromEvent(m(n.GZwK.NnlN)+"___"+n.GZwK.YnAb.zGIt,n.Cwga),e.validate(n.VgQE,n.PvKO,n.bjhS))})),s(this,"kuNq",(function(e,t,i,r){n.jpEw=!0,clearTimeout(n.timerDidnt),console.log("received event for nkpi"),(new ee).unregisterFromEvent(m(n.AvEL.NnlN)+"___"+n.AvEL.YnAb.zGIt,n.kuNq)})),s(this,"WIIa",(function(t,i,r,o){var a,s;console.log("in onreceive event"),console.log("across session value is ",n.across_sessions);var l=ee.getInstance();if(n.LpfT){if(null!==(a=window.ApxorRTM)&&void 0!==a&&a.isBadgePresent&&null!==(s=window.ApxorRTM)&&void 0!==s&&s.badgesLists.includes(n.VgQE)&&e.getController().isBadgeTriggerSatisfied(n.VgQE))return n.xybO=!0,n.rWxw.IqFs=r,void l.validate(n.VgQE,n.PvKO);if(m(n.rWxw.NnlN)===t&&n.xzDS(r-n.rWxw.YYjm.IqFs,n.rWxw.ZzIB)&&n.rWxw.YnAb.zGIt===i&&n.YNmU(n.rWxw.YnAb.GIXJ,o)&&(console.log("increasing satisfaction count for",n.rWxw.YnAb.zGIt),n.gvYi+=1,n.xybO=n.PuHd(n.gvYi,n.rWxw.deYH,n.rWxw.mYCN),n.xybO)){if(n.rWxw.IqFs=r,n.across_sessions){var u=x(n.rWxw._time.unit,n.rWxw._time.value),v=n.rWxw._timeEnabled,c=n.rWxw._id,d=n.gvYi;n.sAMr(n.rWxw.ihHi,i,r,o,u,v,c,d)}l.validate(n.VgQE,n.PvKO,n.bjhS)}}else if(n.LpfT=n.hMzA(t,i,r,o),n.LpfT){var g=n.rWxw,f=g.YYjm;if(f.IqFs=r,"activity_time"===(null==g?void 0:g.NnlN)){var _,h,p,w,b=null==g||null===(_=g.YnAb)||void 0===_||null===(_=_.GIXJ)||void 0===_?void 0:_.time;(null==g||null===(h=g.MHBj)||void 0===h?void 0:h.length)>0?setTimeout((function(){var t;(null===(t=e.getController())||void 0===t?void 0:t._appEventsNoKpi).length<=2&&g.MHBj===location.pathname&&n._displayCampaign(r)}),b):(null==g||null===(p=g.YnAb)||void 0===p||null===(p=p.GIXJ)||void 0===p?void 0:p.nkpi.length)>0?(setTimeout((function(){n.jpEw||(n.xybO=!0,n.xybO&&(n.gvYi+=1,n.xybO=n.PuHd(n.gvYi,n.rWxw.deYH,n.rWxw.mYCN),n.xybO&&(n.rWxw.IqFs=r,l.validate(n.VgQE,n.PvKO)))),g.YnAb.GIXJ.nkpi.map((function(e){l.unregisterFromEvent(y(g.YnAb.GIXJ.et)+"___"+e,n),n.LpfT=!1}))}),b),g.YnAb.GIXJ.nkpi.map((function(e){l.registerForEvent(y(g.YnAb.GIXJ.et)+"___"+e,n.kuNq)}))):(null==g||null===(w=g.YnAb)||void 0===w||null===(w=w.GIXJ)||void 0===w?void 0:w.kpi.length)>0&&(setTimeout((function(){g.YnAb.GIXJ.kpi.map((function(e){l.unregisterFromEvent(y(g.YnAb.GIXJ.et)+"___"+e,n)}))}),b),g.YnAb.GIXJ.kpi.map((function(e){e===g.YYjm.YnAb.zGIt?(l.unregisterFromEvent(m(f.NnlN)+"___"+f.YnAb.zGIt,n),l.registerForEvent(y(g.YnAb.GIXJ.et)+"___"+e,n.ASiy)):l.registerForEvent(y(g.YnAb.GIXJ.et)+"___"+e,n.kiEG)})))}else l.unregisterFromEvent(m(f.NnlN)+"___"+f.YnAb.zGIt,n),l.registerForEvent(m(g.NnlN)+"___"+g.YnAb.zGIt,n);n.RdsQ[i]=Date.now()}})),s(this,"ZgNh",(function(e,t,i,r){var o=ee.getInstance();m(n.KyEg.NnlN)===e&&n.xzDS(i,n.KyEg.ZzIB)&&n.KyEg.YnAb.zGIt===t&&n.YNmU(n.KyEg.YnAb.GIXJ,r)&&(console.log("increasing satisfaction count for termination",n.rWxw.YnAb.zGIt),n.gvYi+=1,n.xybO=n.PuHd(n.gvYi,n.KyEg.deYH,n.KyEg.mYCN),n.xybO&&(n.KyEg.IqFs=i,o.validateForTermination(n.VgQE,n.PvKO)))})),s(this,"hMzA",(function(e,t,i,r){var o=n.rWxw.YYjm,a=m(o.NnlN)===e&&o.YnAb.zGIt===t&&n.xzDS(i,o.ZzIB)&&n.YNmU(o.YnAb.GIXJ,r);return a="APX_PAGE_OPENED"===t?a&&location.pathname===o.YnAb.BsyB:a})),s(this,"xzDS",(function(e,t){var n=Math.ceil(e);return n>t.uxFs&&n<t.hjiW})),s(this,"PuHd",(function(e,t,i){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];switch(r&&n.rWxw.DUvP&&(e+=n.qCDF),i){case"EQ":return e===t;case"GT":return e>t;case"GTE":return e>=t;case"LT":return e<t;case"LTE":return e<=t;default:return!1}})),s(this,"YNmU",(function(e,t){var n=!0;try{var r,o=function(){if(!1===n)return{v:!1};if("object"===i(e[a])){var r,o,s,l=e[a].op,u=e[a].t;if("s"===u)s=e[a].val;else if("l"===u||"f"===u)s=parseFloat(e[a].val);else if("b"===u)switch(e[a].val){case"true":s=!0;break;case"false":s=!1;break;default:s=e[a].val}var v,c=(Array.isArray(t[a])?t[a]:[t[a]]).some((function(e){return"s"===u?e="".concat(e):"l"===u?e=parseInt(e):"f"===u?e=parseFloat(e):"b"===u&&(e=!!e),w(e,s,l)}));if(!(null===(r=e[a])||void 0===r||!r.present)&&(null===(o=e[a])||void 0===o?void 0:o.present))v=!!t.hasOwn(t,a),n=n&&v;n=n&&c}else n=n&&w(t[a],e[a],"EQ")};for(var a in e)if(r=o())return r.v}catch(e){O.error(e),n=!1}return n})),s(this,"sAMr",(function(t,i,r,o,a,s,l,u){console.log("persisting satisfied conditions");var v,c=!1;n.no_KPI_TriggerDetails=e.getController().getFromStorage("apx_nokpi_triggerdetails"),null===n.no_KPI_TriggerDetails||void 0===n.no_KPI_TriggerDetails?n.no_KPI_TriggerDetails=[]:n.no_KPI_TriggerDetails=JSON.parse(n.no_KPI_TriggerDetails);var d,g=0;s&&(g=Date.now()+a);for(var f=0;f<n.no_KPI_TriggerDetails.length;f++)if(n.no_KPI_TriggerDetails[f].id===l){c=!0,v=n.no_KPI_TriggerDetails[f];break}c?v.satisfiedCount+=1:(d={id:l,type:t,time:r,name:i,additionalInfo:o,satisfiedCount:u,timeBased:s,finishTime:g},n.no_KPI_TriggerDetails.push(d)),e.getController().persistToStorage("apx_nokpi_triggerdetails",JSON.stringify(n.no_KPI_TriggerDetails))})),s(this,"AOlM",(function(e){console.log("unregister all conditions");var t,i=new ee,r=c(e);try{for(r.s();!(t=r.n()).done;){var o=t.value;if(1===(null==o?void 0:o.length)||void 0===(null==o?void 0:o.length))i.unregisterFromEvent(m(null==o?void 0:o.rWxw.NnlN)+"___"+(null==o?void 0:o.rWxw.YnAb.zGIt),n.WIIa);else{var a,s=c(o);try{for(s.s();!(a=s.n()).done;){var l,u=a.value;i.unregisterFromEvent(m(null==u?void 0:u.rWxw.NnlN)+"___"+(null==u||null===(l=u.rWxw)||void 0===l?void 0:l.YnAb.zGIt),n.WIIa)}}catch(e){s.e(e)}finally{s.f()}}}}catch(e){r.e(e)}finally{r.f()}}))}return a(t,[{key:"_displayCampaign",value:function(e){console.log("in display campaign");var t=ee.getInstance();this.xybO=!0,this.xybO&&(this.gvYi+=1,this.xybO=this.PuHd(this.gvYi,this.rWxw.deYH,this.rWxw.mYCN),this.xybO&&(this.rWxw.IqFs=e,t.validate(this.VgQE,this.PvKO)))}}]),t}(),q=window.ApxorLogger,S=a((function t(){var n=this;r(this,t),s(this,"deYH",0),s(this,"vrRQ",0),s(this,"ktFP","SESSION"),s(this,"oXFA",0),s(this,"rjtl",0),s(this,"hhtR",0),s(this,"parse",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{n.VgQE=e._id,n.Ciqv=e.meta,n.deYH=e.frequency.count,-1===n.deYH&&(n.deYH=1e3),n.hhtR=n.deYH,n.vrRQ=e.frequency.time_interval,n.ktFP=e.frequency.validity,n.rjtl=e.frequency.ses_lmt,n._dayCount=e.frequency.day_lmt;var t=ee.getInstance().getQeState();if(!f(t)||!f(t[e._id]))return!0;if("SESSION"===n.ktFP){if(n.deYH=parseInt(n.deYH)-parseInt(t[e._id].SESSION),n.deYH<=0)return n.OFxm("Session limit reached"),console.warn("Max count limit reached for session:"+e._id),!1}else{if("OVERALL"!==n.ktFP)return q.info("Invalid config."),!1;if(n.deYH=parseInt(n.deYH)-parseInt(t[e._id].OVERALL),n.deYH<=0)return n.OFxm("Overall limit reached"),console.warn("Max count limit reached for overall:"+e._id),!1}}catch(e){return q.error(e),!1}return!0})),s(this,"UtKe",(function(){n.deYH=n.deYH-1})),s(this,"getFrequencyCount",(function(){return n.deYH})),s(this,"dPRm",(function(){"SESSION"===n.ktFP&&(n.deYH=n.hhtR,q.info("Campaign Limit reset"))})),s(this,"dvwF",(function(e){try{if(n.deYH<=0)return"OVERALL"===n.ktFP?n.OFxm("Overall limit reached"):"SESSION"===n.ktFP&&n.OFxm("Session limit reached"),!1;var t=ee.getInstance().getQeState();if(!f(t)||!f(t[e]))return!0;if(0!==n.rjtl)if(parseInt(n.rjtl)-parseInt(t[e].SESSION)<=0)return n.OFxm("Session limit reached"),!1;if(0!==n._dayCount){var i,r=A();if(parseInt(n._dayCount)-parseInt((null===(i=t[e])||void 0===i?void 0:i.DATES[r])||0)<=0)return n.OFxm("Day limit reached"),!1}}catch(e){n.OFxm("Error validating the frequency: ".concat(e)),q.error("Error validating the frequency:"+e)}return!0})),s(this,"OFxm",(function(t){var i;null==e||e.logEvent("apx_non_eligible_user",{apx_nudge_type:"SURVEY"===n.Ciqv.type?"survey":"campaign",apx_nudge_id:n.VgQE,apx_nudge_name:n.Ciqv.name,apx_variant_code:n.Ciqv.isExperiment||n.Ciqv.only_context?null===(i=n.Ciqv.attr)||void 0===i?void 0:i.apx_variant_code:"TG",apx_failure_type:"warn",apx_reason:t})}))})),D=window.ApxorLogger,z=a((function e(){var t=this;r(this,e),s(this,"ufjb",[]),s(this,"xvLF",0),s(this,"NTEc",!1),s(this,"KUFn",void 0),s(this,"initialize",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"unordered",o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],a=arguments.length>5?arguments[5]:void 0,s=arguments.length>6&&void 0!==arguments[6]&&arguments[6];t.VgQE=n,t.PvKO=i,t.TtoS=o,t.knai=r,t.across_sessions=s;var l=[];t.xvLF=e.length;try{if(null!=l)return r=null==e?void 0:e.sequence_type,l=t.yliV(e,t.xvLF),"unordered"!==a&&0!==t.PvKO||t.bBZB(),t.ufjb}catch(e){return D.error(e),!1}})),s(this,"yliV",(function(e,n){for(var i=0;i<n;i++){t.KUFn=new T;try{t.KUFn.initialize(e[i],t.VgQE,t.PvKO,t.knai,t.uwka,t.across_sessions,"",-1,!1)&&(t.ufjb.push(t.KUFn),t.ufjb.sequence_type=t.knai)}catch(e){D.error(e)}}return t.ufjb})),s(this,"bBZB",(function(){if("ordered"===t.knai||"strictly_ordered"===t.knai)t.ufjb[0].bBZB(0);else{var e,n=c(t.ufjb);try{for(n.s();!(e=n.n()).done;){e.value.bBZB()}}catch(e){n.e(e)}finally{n.f()}}})),s(this,"AOlM",(function(e){console.log("unregister all conditions group"),t.KUFn.AOlM(e)}))})),P=a((function e(){var t=this;r(this,e),s(this,"zGIt",""),s(this,"ihHi",""),s(this,"parse",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{var n,i;t.zGIt=e.meta.name,t.ihHi=e.meta.type,t._only_context=e.meta.only_context,t._attr=(null===(n=e.meta)||void 0===n?void 0:n.attr)||{},t._isExperiment=null===(i=e.meta)||void 0===i?void 0:i.isExperiment}catch(e){return window.ApxorLogger.error(e),!1}return!0}))})),H=window.ApxorLogger,j=a((function t(){var n=this;r(this,t),s(this,"nYjj",[]),s(this,"_ret_day",{}),s(this,"LGle",{}),s(this,"XNhu",!1),s(this,"CtCG",!1),s(this,"retainedDaysValidated",!0),s(this,"retainedSessionValidated",!0),s(this,"eventDoneInLT",!1),s(this,"parse",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{n.nYjj=e.overall_cfg.events,n._ret_day=e.overall_cfg.ret_day,n.LGle=e.overall_cfg.session,n.XNhu=e.overall_cfg.toggleRetDay,n.CtCG=e.overall_cfg.toggleSession}catch(e){return H.error(e),!1}return!0})),s(this,"validate",(function(){var t=parseInt(e.getController().getFromStorage("apx_retained_days")),i=parseInt(e.getController().getFromStorage("apx_retained_session"));if(n.XNhu&&!isNaN(t)&&!(t>=n._ret_day.from&&t<=n._ret_day.to))return n.retainedDaysValidated=!1,!1;if(n.CtCG&&!isNaN(i)&&!(i>=n.LGle.from&&i<=n.LGle.to))return n.retainedSessionValidated=!1,!1;try{for(var r=e.getController().getFromStorage("_apx_lt_count"),o=e.getSiteId(),a=JSON.parse((new TextDecoder).decode(function(e){for(var t=new ArrayBuffer(e.length),n=new Uint8Array(t),i=0;i<e.length;i++)n[i]=e.charCodeAt(i);return t}(p(o,r)))),s=0;s<n.nYjj.length;s++){if(a[n.nYjj[s].name.replace("'","").replace("â€™","")])return n.eventDoneInLT=!0,!1}}catch(e){H.error("Failed to validate the lt count:"+e)}return!0}))})),V=window.ApxorLogger,L=a((function e(){var t=this;r(this,e),s(this,"AVOu",[]),s(this,"sGkC",[]),s(this,"parse",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{if(t.AVOu=e.attributes.user,t.sGkC=e.attributes.session,!Array.isArray(t.AVOu)||!Array.isArray(t.sGkC))return V.error("No attributes"),!1}catch(e){return V.error(e),!1}return!0})),s(this,"validate",(function(e,n){return t.yDYz(e,t.AVOu)&&t.yDYz(n,t.sGkC)})),s(this,"yDYz",(function(e,t){var n=t.length,i=!0;try{for(var r,o=function(){var n=t[a];if(!e[n.name]||!1===i)return{v:!1};var r=n.operator,o=n.type,s=n.value.map((function(e){return"s"===o?e:"l"===o?parseInt(e):"f"===o?parseFloat(e):void 0})),l=(Array.isArray(e[n.name])?e[n.name]:[e[n.name]]).some((function(e){return s.some((function(t){return w(e,t,r)}))}));i=i&&l},a=0;a<n;a++)if(r=o())return r.v}catch(e){V.error(e),i=!1}return i}))})),B=a((function t(){var n=this;r(this,t),s(this,"ubHI",e.getController()),s(this,"type",""),s(this,"_duration_seconds",0),s(this,"EYeG",1),s(this,"parse",(function(e){try{var t,i,r;if(n.ihHi=null===(t=e.terminate_info.time_based)||void 0===t?void 0:t.type,n._duration_seconds=null===(i=e.terminate_info)||void 0===i?void 0:i.time_based.duration_seconds,n.EYeG=null===(r=e.terminate_info.time_based)||void 0===r?void 0:r.days,n.gWfc(e._id))return n.ubHI.persistTerminationInfoLocally(e._id),!1}catch(e){return!1}return!0})),s(this,"gWfc",(function(e){var t,i=JSON.parse(n.ubHI.getFromStorage("apx_termination_ID"));if(!i[e]||null===(t=i[e])||void 0===t||!t.startDate)return!1;var r,o=new Date(i[e].startDate),a=new Date((r=new Date).getMonth()+"/"+r.getDate()+"/"+r.getFullYear()),s=parseInt((a-o)/864e5,10),l=function(){var e=new Date;return{hours:e.getHours(),mins:e.getMinutes()}}(),u=i[e].pZIJ;return s===n.EYeG&&l.hours>=u.hours||s>n.EYeG||i[e].goalAcheived}))})),Z=a((function e(){var t=this;r(this,e),s(this,"enable_goal_events",!1),s(this,"attributes",{}),s(this,"NDrJ",new L),s(this,"Otiu",new B),s(this,"parse",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{var n,i,r;if(t.enable_time_based=null==e||null===(n=e.terminate_info)||void 0===n?void 0:n.enable_time_based,t.enable_time_based&&!t.Otiu.parse(e))return!1;if(t.enable_goal_events=null==e||null===(i=e.terminate_info)||void 0===i?void 0:i.enable_goal_events,t.enable_attributes=null==e||null===(r=e.terminate_info)||void 0===r?void 0:r.enable_attributes,t.enable_attributes&&!t.NDrJ.parse(e.terminate_info))return!1}catch(e){return window.ApxorLogger.error(e),!1}return!0})),s(this,"validate",(function(e,n){return t.NDrJ.validate(e,n)}))})),K=window.ApxorLogger,M=a((function e(){var t=this;r(this,e),s(this,"fNIp",-1),s(this,"OhKB",-1),s(this,"pZIJ",-1),s(this,"vEcC",-1),s(this,"lHDT",!1),s(this,"_nudge_expired",!1),s(this,"_not_yet_active",!1),s(this,"_not_in_specified_time",!1),s(this,"parse",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{if(isNaN(Date.parse(e.validity.start_date))||isNaN(Date.parse(e.validity.end_date)))return K.error("Not valid dates"),!1;if(t.fNIp=Date.parse(e.validity.start_date),t.OhKB=Date.parse(e.validity.end_date),f(e.at_specific_time)&&(t.lHDT=e.at_specific_time,t.lHDT&&f(e.time_limits))){var n=(new Date).toISOString().split("T")[0];if(t.pZIJ=Date.parse(n+"T"+e.time_limits.start_time+":00.000Z"),t.vEcC=Date.parse(n+"T"+e.time_limits.end_time+":00.000Z"),isNaN(t.pZIJ)||isNaN(t.vEcC))return K.error("Not valid times"),!1}}catch(e){return K.error(e),!1}return!0})),s(this,"validate",(function(){var e=Date.now();return e>t.fNIp&&e<t.OhKB?(!t.lHDT||e>=t.pZIJ&&e<=t.vEcC||(t._not_in_specified_time=!0),!t.lHDT||e>=t.pZIJ&&e<=t.vEcC):(e<t.fNIp?t._not_yet_active=!0:e>t.OhKB&&(t._nudge_expired=!0),!1)}))})),R=window.ApxorLogger,Q=a((function t(){var i=this;r(this,t),s(this,"ckGp",[]),s(this,"HVdm",[]),s(this,"VgQE",""),s(this,"Ciqv",new P),s(this,"fSnR",new N),s(this,"ktFP",new M),s(this,"CpLX",new S),s(this,"jumc",new j),s(this,"gUmH",new Z),s(this,"knai",!1),s(this,"uwka",[]),s(this,"_variant_code",""),s(this,"NTEc",!1),s(this,"groupCombineOperator","OR"),s(this,"jpEw",!1),s(this,"pQAA",!1),s(this,"DDyS",void 0),s(this,"timeForKPI",void 0),s(this,"kpiIndex",0),s(this,"gATb",void 0),s(this,"_across_sessions",!1),s(this,"MNAo",void 0),s(this,"NHuE",!1),s(this,"IrHf",void 0),s(this,"yMze",void 0),s(this,"ItYp",void 0),s(this,"GMAn",void 0),s(this,"jFMV",void 0),s(this,"KGzt",void 0),s(this,"tuHV",void 0),s(this,"zNTh",void 0),s(this,"sgwZ",void 0),s(this,"JdvV",void 0),s(this,"parse",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{var t,n;if(!f(e._id))return R.error("No Id"),!1;if(!f(e.enabled)||!e.enabled)return R.error("Not enabled"),!1;if(!(i.Ciqv.parse(e)&&i.ktFP.parse(e)&&i.CpLX.parse(e)&&i.fSnR.parse(e)&&i.jumc.parse(e)&&i.gUmH.parse(e)))return!1;if(i._variant_code=i.Ciqv._isExperiment||i.Ciqv._only_context?null===(t=i.Ciqv._attr)||void 0===t?void 0:t.apx_variant_code:"TG",i._across_sessions=!(null==e||!e.across_sessions)&&(null==e?void 0:e.across_sessions),!f(e.conditions)||!Array.isArray(e.conditions))return R.error("No valid conditions",e.conditions),!1;i.VgQE=e._id,i.knai=!!f(e.sequence_enabled)&&e.sequence_enabled,f(e.conditions_v2)&&(i.knai=null==e?void 0:e.sequence_type),!0===i.knai&&e.conditions.sort((function(e,t){return e.sequence<t.sequence})),f(e.conditions_v2)?(n=e.conditions_v2,i.NHuE=!0):n=e.conditions,i.MNAo=n;var r=n.length;if(i.JdvV=r,i.IybD(n,r),console.log(i.ckGp),i.MDoj(),console.log(i.ckGp),i.gUmH.enable_goal_events)for(var o=e.terminate_info.goal_events.events,a=o.length,s=0;s<a;s++){var l=new T;l.initialize(o[s],i.VgQE,s,!0,[],i._across_sessions,"termination")&&i.HVdm.push(l)}return console.log("conditional validator parse"),i.ckGp.length>0}catch(e){return R.error(e),!1}})),s(this,"IybD",(function(e,t){for(var n=0;n<t;n++){i.uwka=[];var r=e[n];if("group"===(null!=r&&r.condition_type?null==r?void 0:r.condition_type:"single")){var o=r.conditions_v2;i.groupCombineOperator=r.combine_operator;var a=null==r?void 0:r.sequence_type;i.sgwZ=new z;var s=i.sgwZ.initialize(o,i.VgQE,n,a,i.uwka,i.knai,i._across_sessions);i.ckGp.push(s),console.log(i.sgwZ)}else{if("didn't"===r.type){var u,v={trigger_key:r.trigger.details.name,no_kpi_array:null==r||null===(u=r.details)||void 0===u||null===(u=u.additional_info)||void 0===u?void 0:u.nkpi,condition_id:null==r?void 0:r._id,time_bounds:r.time_bounds.upper};i.uwka=[].concat(l(i.uwka),[v])}i.sgwZ=new T,i.sgwZ.initialize(r,i.VgQE,n,i.knai,i.uwka,i._across_sessions)&&(i.ckGp.push(i.sgwZ),console.log(i.ckGp))}}})),s(this,"MDoj",(function(){if(i._across_sessions&&"ordered"===i.knai){var t=!1;console.log("across_sesions_case");var n=e.getController().getFromStorage("apx_nokpi_triggerdetails");if(null!=(n=JSON.parse(n))&&null!=n)for(var r=function(e){var r,o,a;if(null!==(r=i.ckGp[e])&&void 0!==r&&null!==(r=r.rWxw)&&void 0!==r&&r._timeEnabled&&void 0===i.ckGp[e].length){if("didn't"===i.ckGp[e].rWxw.ihHi){var s=i.ckGp[e].rWxw._id,l=i.FsVj(s,n);if(l)if(Date.now()>l.finishTime)i.ckGp[e].xybO=!0,i.ckGp[e].gvYi=l.satisfiedCount,t=!0;else{var u=l.finishTime-Date.now(),v=i.ckGp[e].rWxw._eventCategory?i.ckGp[e].rWxw._eventCategory:"specific_event",c=new ee;"specific_event"===v?(c.registerForEvent(m(i.ckGp[e].rWxw.NnlN)+"___"+i.ckGp[e].rWxw.YnAb.zGIt,i.kuNq),i.jFMV=i.ckGp[e]):i.XAje(v),setTimeout((function(){e!==i.ckGp.length-1||i.jpEw||(i.ckGp[e].xybO=!0,i.ckGp[e].gvYi=l.satisfiedCount,t=!0,"specific_event"===v?c.unregisterFromEvent(m(i.ckGp[e].rWxw.NnlN)+"___"+i.ckGp[e].rWxw.YnAb.zGIt,i.kuNq):i.PtDT(i.ckGp[e]),i.Nvtz())}),u)}}if("did"===i.ckGp[e].rWxw.ihHi){var d=i.ckGp[e].rWxw._id,g=i.FsVj(d,n);if(g)if(null==g.satisfiedCount){if(Date.now()<g.finishTime){console.log("time is left will add set time out again"),i.ItYp=g,i.yMze=e;var f=g.finishTime-Date.now(),_=i.ckGp[e].rWxw._eventCategory?i.ckGp[e].rWxw._eventCategory:"specific_event",h=new ee;"specific_event"===_?h.registerForEvent(m(i.ckGp[e].rWxw.NnlN)+"___"+i.ckGp[e].rWxw.YnAb.zGIt,i.GYvp):i.XAje(_),setTimeout((function(){"specific_event"===_?h.unregisterFromEvent(m(i.ckGp[e].rWxw.NnlN)+"___"+i.ckGp[e].rWxw.YnAb.zGIt,i.GYvp):i.PtDT(i.ckGp[e])}),f)}}else i.ckGp[e].gvYi=g.satisfiedCount,i.ckGp[e].xybO=!0}}else t=i.nrOj(e,n);t&&(null===(o=i.ckGp[e])||void 0===o||null===(o=o.rWxw)||void 0===o||!o._timeEnabled||(null===(a=i.ckGp[e])||void 0===a?void 0:a.length)>1)?e===i.ckGp.length-1&&i.Nvtz():t||void 0===!i.ckGp[e].length&&i.ckGp[e].bBZB()},o=0;o<i.ckGp.length;o++)r(o)}else if(i._across_sessions&&"unordered"===i.knai){var a=e.getController().getFromStorage("apx_nokpi_triggerdetails");if(null!=(a=JSON.parse(a))&&null!=a)for(var s=0;s<i.ckGp.length;s++)i.nrOj(s,a)}})),s(this,"nrOj",(function(e,t){if(void 0===i.ckGp[e].length||1===i.ckGp[e].length){var n=i.ckGp[e].rWxw._id,r=!1,o=i.FsVj(n,t);if(o)i.IrHf=o,r=(new T).PuHd(o.satisfiedCount,i.ckGp[e].rWxw.deYH,i.ckGp[e].rWxw.mYCN),o&&(r?i.ckGp[e].xybO=!0:i.ckGp[e].gvYi=o.satisfiedCount);else i.ckGp[e].bBZB();return r}if(i.ckGp[e].length>=1){var a,s,l;if("ordered"===(s=null===(a=i.ckGp[e])||void 0===a?void 0:a.sequence_type)||"strictly_ordered"===s){for(var u=0;u<i.ckGp[e].length;u++){var v=i.ckGp[e][u],c=v.rWxw._id;l=!1;var d=i.FsVj(c,t);if(d){if(l=(new T).PuHd(d.satisfiedCount,v.rWxw.deYH,v.rWxw.mYCN),d)if(l){i.ckGp[e][u].xybO=!0;var _=u+1;console.log("nested and then");var h=i.ckGp[e][u+1];void 0===h&&f(i.ckGp[e+1])&&(i.ckGp[e+1].bBZB(),l=!0),null!=h&&i.ckGp[e][u+1].bBZB(_)}else i.ckGp[e][u].gvYi=d.satisfiedCount}else(f(i.ckGp[e][u-1])&&!0===i.ckGp[e][u].xybO||g(i.ckGp[e][u-1]))&&i.ckGp[e][u].bBZB()}return l}for(var p,m=0;m<i.ckGp[e].length;m++){var y=i.ckGp[e][0].rWxw.Rflv;p="OR"!==y;var w=i.ckGp[e][m],x=w.rWxw._id;l=!1;var b=i.FsVj(x,t);if(b)l=(new T).PuHd(b.satisfiedCount,w.rWxw.deYH,w.rWxw.mYCN),b&&(l?i.ckGp[e][m].xybO=!0:i.ckGp[e][m].gvYi=b.satisfiedCount);else w.bBZB();p="AND"===y?p&&l:p||l}return p}})),s(this,"FsVj",(function(e,t){return t.find((function(t){return t.id===e}))})),s(this,"dmaD",(function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;console.log("coming to dmaD");var r=ee.getInstance();if(!(t<0)){var o=i.ckGp[t],a="unordered";if((null==o?void 0:o.length)>1&&(a=null==o?void 0:o.sequence_type),!0===i.knai||"ordered"===i.knai||"strictly_ordered"===i.knai||"ordered"===a||"strictly_ordered"===a){console.log("respect sequence ordered"),i.kpiIndex=t+1;var s=i.ckGp[t];if((null==s?void 0:s.length)>0){if(f(s))if("unordered"===i.knai&&"ordered"===a){var l=o[n-1];if(f(l))if(void 0===l.length||1==l.length){if(!l.xybO)return}else if(l.length>1&&!i.YWnK(l))return;var u,v=o[n+1];if(f(v)){if(v.bBZB(n+1),"strictly_ordered"===i.knai){i._currentEventname=s[n].rWxw.YnAb.zGIt;var d=e.getController();d.registerForEvent("APP_EVENT",i.tTTh),d.registerForEvent("CLIENT_EVENT",i.tTTh)}}else if("strictly_ordered"===a)1!=i.NTEc&&i.Nvtz();else(null===(u=o[n])||void 0===u?void 0:u.length)>0?i.YWnK(o)&&i.Nvtz():i.Nvtz()}else{var g,_=i.ckGp[t-1];if(f(_))if(void 0===_.length||1==_.length){if(!_.xybO)return}else if(_.length>1&&!i.YWnK(_))return;if(void 0===s.length||1===s.length?g=i.ckGp[t+1]:s.length>1&&("ordered"===a||"strictly_ordered"===a?g=n===s.length-1?i.ckGp[t+1]:i.ckGp[t][n+1]:i.YWnK(s)&&(g=i.ckGp[t+1])),f(g)){if(void 0===g.length||1===g.length)g.bBZB(n+1);else if(i.YWnK(s))if(void 0===g.length)g.bBZB();else if(g.length>1)if("unordered"===g.sequence_type)for(var h=0;h<g.length;h++)g[h].bBZB(h);else"ordered"!==g.sequence_type&&"strictly_ordered"!==g.sequence_type||g[0].bBZB(0);if("strictly_ordered"===i.knai){i._currentEventname=s[n].rWxw.YnAb.zGIt;var p=e.getController();p.registerForEvent("APP_EVENT",i.tTTh),p.registerForEvent("CLIENT_EVENT",i.tTTh)}}else"strictly_ordered"===i.knai?1!=i.NTEc&&i.Nvtz():i.YWnK(s)&&i.Nvtz()}}else if(f(s)&&s.xybO){s.RdsQ[s.rWxw.YnAb.zGIt]=Date.now();var y=i.ckGp[t-1];if(f(y))if(void 0===y.length||1==y.length){if(!y.xybO)return}else if(y.length>1&&!i.YWnK(y))return;var w=i.ckGp[t+1];if(f(w)){var b,A;if(null!=w&&null!==(b=w.rWxw)&&void 0!==b&&b._timeEnabled){if("session"!=(null===(A=w.rWxw)||void 0===A?void 0:A._time.unit)){var E,N,G=x(w.rWxw._time.unit,w.rWxw._time.value);if("didn't"==(null===(E=w.rWxw)||void 0===E?void 0:E.ihHi)){if(i.tuHV=setTimeout((function(){if(!i.jpEw){if(w.xybO=!0,w.xybO){w.gvYi+=1;var e=new T;if(w.xybO=e.PuHd(w.gvYi,w.rWxw.deYH,w.rWxw.mYCN),console.log("expected here"),w.xybO){w.rWxw.IqFs=Date.now();var n=t+1,o=i.ckGp[n+1];f(o)?(console.log("registering next condition"),o.bBZB()):i.Nvtz()}}r.unregisterFromEvent(m(w.rWxw.NnlN)+"___"+w.rWxw.YnAb.zGIt,i.kuNq),w.LpfT=!1}}),G),console.log("expected here"),i._across_sessions){var k=x(w.rWxw._time.unit,w.rWxw._time.value),I=w.rWxw._timeEnabled,Y=w.rWxw._id,C=new T;C.sAMr(w.rWxw.ihHi,w.rWxw.YnAb.zGIt,Date.now(),w.rWxw.YnAb.GIXJ,k,I,Y)}console.log(w.rWxw._timeEnabled),"specific_event"===w.rWxw._eventCategory?(r.registerForEvent(m(w.rWxw.NnlN)+"___"+w.rWxw.YnAb.zGIt,i.kuNq),i.jFMV=w):i.XAje(w)}else if("did"==(null===(N=w.rWxw)||void 0===N?void 0:N.ihHi)&&(i.jpEw=!1,i.gATb=w,f(i.ckGp[t+2])&&i._across_sessions&&(i.GMAn=i.ckGp[t+2]),i.zNTh=setTimeout((function(){i.jpEw||(i.jpEw=!1,r.unregisterFromEvent(m(w.rWxw.NnlN)+"___"+w.rWxw.YnAb.zGIt,i.kiEG))}),G),i.DDyS=s,i.timeForKPI=G,r.registerForEvent(m(w.rWxw.NnlN)+"___"+w.rWxw.YnAb.zGIt,i.kiEG),i.KGzt=w,console.log("error check"),i._across_sessions)){var W=x(w.rWxw._time.unit,w.rWxw._time.value),F=w.rWxw._timeEnabled,O=w.rWxw._id,q=new T;q.sAMr(w.rWxw.ihHi,w.rWxw.YnAb.zGIt,Date.now(),w.rWxw.YnAb.GIXJ,W,F,O)}}}else if(w.length>0)if("ordered"===w.sequence_type||"strictly_ordered"===w.sequence_type)w[0].bBZB(n+1);else{var S,D=c(w);try{for(D.s();!(S=D.n()).done;){var z=S.value;z.bBZB()}}catch(e){D.e(e)}finally{D.f()}}else w.bBZB();if(console.log("validating second condition"),"strictly_ordered"===i.knai){i._currentEventname=s.rWxw.YnAb.zGIt;var P=e.getController();P.registerForEvent("APP_EVENT",i.tTTh),P.registerForEvent("CLIENT_EVENT",i.tTTh)}}else"strictly_ordered"===i.knai?1!=i.NTEc&&i.Nvtz():i.Nvtz()}}else i.FsWY(),console.log(i.ckGp),i.Nvtz()}})),s(this,"tTTh",(function(e){e&&e.name!=i._currentEventname&&(i.NTEc=!0)})),s(this,"XAje",(function(e){var t=new ee,n=e.rWxw._eventCategory;"apxor_event"===n?t.registerForEvent("apxor_event",i.kuNq):"customer_event"===n?t.registerForEvent("customer_event",i.kuNq):"any_event"===n?t.registerForEvent("any_event",i.kuNq):"campaign_event"===n?t.registerForEvent("campaign_event",i.kuNq):"survey_event"===n&&t.registerForEvent("survey_event",i.kuNq)})),s(this,"PtDT",(function(e){var t=new ee,n=e.rWxw._eventCategory;"apxor_event"===n?t.unregisterFromEvent("apxor_event",i.kuNq):"customer_event"===n?t.unregisterFromEvent("customer_event",i.kuNq):"any_event"===n?t.unregisterFromEvent("any_event",i.kuNq):"campaign_event"===n?t.unregisterFromEvent("campaign_event",i.kuNq):"survey_event"===n&&t.unregisterFromEvent("survey_event",i.kuNq)})),s(this,"kuNq",(function(){var e,t;console.log("received event of nkpi"),i.tuHV&&clearTimeout(i.tuHV);var n=new ee;i.jpEw=!0,i._across_sessions&&null!==localStorage.getItem("apx_nokpi_triggerdetails")&&localStorage.removeItem("apx_nokpi_triggerdetails"),n.unregisterFromEvent(m(null===(e=i.jFMV)||void 0===e||null===(e=e.rWxw)||void 0===e?void 0:e.NnlN)+"___"+(null===(t=i.jFMV)||void 0===t||null===(t=t.rWxw)||void 0===t||null===(t=t.YnAb)||void 0===t?void 0:t.zGIt),i.kuNq)})),s(this,"kiEG",(function(){var t,n,r,o=new ee;console.log("configitem kpi check"),i.jpEw=!0,i.zNTh&&clearTimeout(i.zNTh);var a=new T;if(i.gATb.gvYi+=1,i.gATb.xybO=a.PuHd(i.gATb.gvYi,i.gATb.rWxw.deYH,i.gATb.rWxw.mYCN),o.unregisterFromEvent(m(null===(t=i.KGzt)||void 0===t||null===(t=t.rWxw)||void 0===t?void 0:t.NnlN)+"___"+(null===(n=i.KGzt)||void 0===n||null===(n=n.rWxw)||void 0===n?void 0:n.YnAb.zGIt),i.kiEG),i._across_sessions&&null!==(r=i.GMAn)&&void 0!==r&&r.rWxw._timeBased){var s,l,u,v=e.getController().getFromStorage("apx_nokpi_triggerdetails");v=null==v?[]:JSON.parse(v);for(var c=0;c<v.length;c++)if(i.no_KPI_TriggerDetails[c].id===i.GMAn.rWxw._id){s=!0,l=v[c];break}if(s)l.satisfiedCount+=1;else{var d=i.gATb.rWxw._id,g=i.gATb.rWxw.ihHi,_=i.gATb.rWxw.YnAb.zGIt,h=i.gATb.rWxw.YnAb.GIXJ;u={id:d,type:g,time:Date.now(),name:_,additionalInfo:h,satisfiedCount:i.gATb.rWxw._timeEnabled,timeBased:i.gATb.rWxw._timeEnabled},i.no_KPI_TriggerDetails.push(u)}}if(i.gATb.xybO){var p=i.ckGp[i.kpiIndex+1];f(p)?p.bBZB():i.Nvtz()}})),s(this,"GYvp",(function(){if(i.yMze===i.ckGp.length-1){i.pQAA=!0;i.ckGp[i.yMze]&&(i.ckGp[i.yMze].gvYi=i.ItYp.satisfiedCount,i.ckGp[i.yMze].xybO=!0,i.Nvtz())}else{var t,n,r=e.getController().getFromStorage("apx_nokpi_triggerdetails");r=null==r?[]:JSON.parse(r);for(var o=0;o<r.length;o++)if(r[o].id===i.yMze){n=!0,t=r[o];break}if(n&&(t.satisfiedCount=1),e.getController().persistToStorage("apx_nokpi_triggerdetails",JSON.stringify(r)),i.ckGp[i.yMze].gvYi=i.ItYp.satisfiedCount,i.ckGp[i.yMze].xybO=!0,i.ckGp[i.yMze+1].rWxw._timeEnabled){var a=x(i.ckGp[i.yMze+1].rWxw._time.unit,i.ckGp[i.yMze+1].rWxw._time.value),s=i.ckGp[i.yMze+1].rWxw._timeEnabled,l=i.ckGp[i.yMze+1].rWxw._id,u=i.ckGp[i.yMze+1].gvYi,v=i.ckGp[i.yMze+1].rWxw.YnAb.zGIt,c=i.ckGp[i.yMze+1].YnAb.GIXJ;(new T).sAMr(i.rWxw.ihHi,v,Date.now(),c,a,s,l,u)}}})),s(this,"FsWY",(function(){if(i._across_sessions&&i.NHuE){var t,n,r,o="single",a=!1,s=e.getController().getFromStorage("apx_nokpi_triggerdetails");if(s=JSON.parse(s),console.log(s),s.length>0){var l,u=c(s);try{var v=function(){var e=l.value;console.log(e);var s=e.id,u=e.satisfiedCount;if(t=i.ckGp.find((function(e,t){if(1===(null==e?void 0:e.length)||void 0===(null==e?void 0:e.length)){if(e.rWxw._id===s)return o="single",n=t,!0}else if(e.length>0){var i=e.findIndex((function(e){return e.rWxw._id===s}));if(-1!==i)return console.log("Matching Condition Index:",t),n=t,console.log("Nested Condition Index:",i),r=i,o="group",!0}return!1})),"single"===o&&t){var v=new T;a=v.PuHd(u,t.rWxw.deYH,t.rWxw.mYCN);var c=i.ckGp.findIndex((function(e){var t;return(null==e||null===(t=e.rWxw)||void 0===t?void 0:t._id)===s}));void 0===c&&(c=n),a&&(i.ckGp[c].xybO=!0)}else if("group"===o&&t){var d=new T;(a=d.PuHd(u,t[r].rWxw.deYH,t[r].rWxw.mYCN))&&(i.ckGp[n][r].xybO=!0,console.log(i.ckGp))}};for(u.s();!(l=u.n()).done;)v()}catch(e){u.e(e)}finally{u.f()}}}})),s(this,"SUiK",(function(e){e<0||i.UUwX()})),s(this,"Nvtz",(function(){var t,r;console.log("in validate all conditions");var o=e.getController().getUserAttributes(),a=e.getController().getSessionAttributes();if(null!==(t=window.ApxorRTM)&&void 0!==t&&t.isBadgePresent&&null!==(r=window.ApxorRTM)&&void 0!==r&&r.badgesLists.includes(i.VgQE)&&e.getController().isBadgeTriggerSatisfied(i.VgQE)||null==e||e.logEvent("apx_trigger_satisfied",{apx_nudge_type:"SURVEY"===i.Ciqv.ihHi?"survey":"campaign",apx_nudge_id:i.VgQE,apx_nudge_name:i.Ciqv.zGIt,apx_variant_code:i.Ciqv._isExperiment||i.Ciqv._only_context?i.Ciqv._attr.apx_variant_code:"TG"}),!i.ktFP.validate()||!i.fSnR.validate(o,a)||!i.jumc.validate()){i.Ciqv.ihHi;return i.jumc.retainedDaysValidated?i.jumc.retainedSessionValidated?i.jumc.eventDoneInLT?void i.OFxm("Event done in life time"):i.fSnR.userAttributesValidated?i.fSnR.sessionAttributeValidated?i.ktFP._not_in_specified_time?void i.OFxm("Time limits check failed"):i.ktFP._not_yet_active?void i.OFxm("not in the scheduled time"):i.ktFP._nudge_expired?void i.OFxm("nudge expired"):void 0:void i.OFxm("Session property filter not met"):void i.OFxm("User property filter not met"):void i.OFxm("User session criteria not met"):void i.OFxm("Retained day criteria not met")}for(var s=i.ckGp.length,l=s<1,u="",v=0;v<s;v++){var d=void 0,g=i.ckGp[v];if(g.length>1){d="AND"===g[0].rWxw.Rflv;for(var f=0;f<g.length;f++){d="AND"===g[0].rWxw.Rflv?d&&g[f].xybO:d||g[f].xybO}}else d=g.xybO;if(""===u.trim())l=d;else switch(u){case"AND":l=l&&d;break;case"OR":l=l||d}u=g.length>1?i.groupCombineOperator:g.Rflv}if(l){var _,h;if(console.debug("onCondition satisfied"),!i.CpLX.dvwF(i.VgQE))return void console.warn("Maximum limit reached",i.VgQE);if(!(null!==(_=window.ApxorRTM)&&void 0!==_&&_.isBadgePresent&&null!==(h=window.ApxorRTM)&&void 0!==h&&h.badgesLists.includes(i.VgQE)&&e.getController().isBadgeTriggerSatisfied(i.VgQE))){var p="SURVEY"===i.Ciqv.ihHi?"survey":"campaign";null==e||e.logEvent("apx_trigger_satisfied",{apx_nudge_type:"SURVEY"===i.Ciqv.ihHi?"survey":"campaign",apx_nudge_id:i.VgQE,apx_nudge_name:i.Ciqv.zGIt,apx_variant_code:i.Ciqv._isExperiment||i.Ciqv._only_context?i.Ciqv._attr.apx_variant_code:"TG"},!1,"",p)}console.log("Dispatching event",i.Ciqv.ihHi),i._across_sessions&&localStorage.removeItem("apx_nokpi_triggerdetails");var m,y=c(i.ckGp);try{for(y.s();!(m=y.n()).done;){var w=m.value;if(1===(null==w?void 0:w.length)||void 0===(null==w?void 0:w.length))w.xybO=!1,w.gvYi=0;else{var x,b=c(w);try{for(b.s();!(x=b.n()).done;){var A=x.value;A.xybO=!1,A.gvYi=0}}catch(e){b.e(e)}finally{b.f()}}}}catch(e){y.e(e)}finally{y.f()}if(console.log("got cv well"),i.sgwZ.AOlM(i.ckGp),i.ckGp=[],i.IybD(i.MNAo,i.JdvV),console.log(i.ckGp),!0===i.Ciqv._only_context){var E="SURVEY"===i.Ciqv.ihHi?"survey":"campaign";e.logEvent("apx_context_evaluated",n(n({},i.Ciqv._attr),{},{message_name:i.Ciqv.zGIt,id:i.VgQE}),!1,"",E)}e.getController().dispatchEvent(i.Ciqv.ihHi,{name:i.Ciqv.ihHi,additional_info:{uuid:i.VgQE,name:i.Ciqv.zGIt}})}})),s(this,"UUwX",(function(){for(var t=i.HVdm.length,r=t<1,o="",a=0;a<t;a++){var s=i.HVdm[a],l=s.xybO;if(""===o.trim())r=l;else switch(o){case"AND":r=r&&l;break;case"OR":r=r||l}o=s.elly}if(r){if(console.log("Dispatching event",i.Ciqv.ihHi),e.getController().persistTerminationInfoLocally(i.VgQE),!0===i.Ciqv._only_context){var u="SURVEY"===i.Ciqv.ihHi?"survey":"campaign";e.logEvent("apx_context_evaluated",n(n({},i.Ciqv._attr),{},{message_name:i.Ciqv.zGIt,id:i.VgQE}),!1,"apxor",u)}e.getController().dispatchEvent(i.Ciqv.ihHi,{name:i.Ciqv.ihHi,additional_info:{uuid:i.VgQE,name:i.Ciqv.zGIt}})}})),s(this,"validateForTerminationAttributes",(function(){var t=e.getController().getUserAttributes(),n=e.getController().getSessionAttributes();return i.gUmH.validate(t,n)})),s(this,"UtKe",(function(){i.CpLX.UtKe()})),s(this,"getFrequencyCount",(function(){return i.CpLX.getFrequencyCount()})),s(this,"asDv",(function(){return i.CpLX.dPRm()})),s(this,"YWnK",(function(e){var t;t="AND"===e[0].rWxw.Rflv;for(var n=0;n<e.length;n++){t="AND"===e[0].rWxw.Rflv?t&&e[n].xybO:t||e[n].xybO}return t})),s(this,"OFxm",(function(t){var n;null==e||e.logEvent("apx_non_eligible_user",{apx_nudge_type:"SURVEY"===i.Ciqv.ihHi?"survey":"campaign",apx_nudge_id:i.VgQE,apx_nudge_name:i.Ciqv.zGIt,apx_variant_code:i.Ciqv._isExperiment||i.Ciqv._only_context?null===(n=i.Ciqv._attr)||void 0===n?void 0:n.apx_variant_code:"TG",apx_failure_type:"warn",apx_reason:t})}))})),J=a((function e(){var t=this;r(this,e),s(this,"ulug",{}),s(this,"parse",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{configs:[]};if(f(e)&&f(e.configs)){var n=e.configs;if(!Array.isArray(n))return;n.sort((function(e,t){var n,i;return(null!==(n=e.prio)&&void 0!==n?n:-1)-(null!==(i=t.prio)&&void 0!==i?i:-1)}));for(var i=0;i<n.length;i++){var r=n[i],o=r._id,a=new Q;a.parse(r)?t.ulug[o]=a:console.warn("Failed to parse cfg",o)}}})),s(this,"validate",(function(e,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(t.ulug[e]){var r=t.ulug[e];r.dmaD(n,i)}})),s(this,"getVariantCode",(function(e){return t.ulug[e]?t.ulug[e]._variant_code:""})),s(this,"validateForTermination",(function(e,n){t.ulug[e]&&t.ulug[e].SUiK(n)})),s(this,"validateForTerminationAttributes",(function(e){return!!t.ulug[e]&&t.ulug[e].validateForTerminationAttributes()})),s(this,"UtKe",(function(e){t.ulug[e].UtKe()})),s(this,"getFrequencyCount",(function(e){return t.ulug[e].getFrequencyCount()})),s(this,"resetFrequencyCounts",(function(){var e=t.ulug;for(var n in e)e[n].asDv()})),s(this,"siZw",(function(e){try{if(t.ulug){var n=t.ulug[e];if(n&&n.Ciqv)return n.Ciqv}}catch(e){console.log("Error in getting the campaign meta ".concat(e))}return{}}))})),X=window.ApxorLogger,U=a((function t(){var n=this;r(this,t),s(this,"Gqai",{}),s(this,"Qihk",[]),s(this,"rOAr",!1),s(this,"initialize",(function(){var t=e.getController();t.registerForEvent("APP_EVENT",(function(e){return n.OPRg(e,"AE")})),t.registerForEvent("CLIENT_EVENT",(function(e){return n.OPRg(e,"CE")}))})),s(this,"waLc",(function(){for(var e in n.Qihk)n.erYk(e.event,e.key,e.type);n.rOAr=!0})),s(this,"ZuiO",(function(e,t){var i;(console.log("bBZB To Event"),"function"==typeof t)&&((i=n.Gqai[e]?n.Gqai[e]:[]).push(t),n.Gqai[e]=i,X.debug("Listeners list: ",n.Gqai))})),s(this,"unregisterFromEvent",(function(e,t){if(n.Gqai[e]){for(var i=n.Gqai[e],r=[],o=0;o<i.length;o++){var a=i[o];a!==t&&r.push(a)}n.Gqai[e]=r}})),s(this,"OPRg",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"AE";n.erYk(e,"any_event",t),"apxor"===(null==e?void 0:e.loggedBy)?(console.log("notifying apxor event listeners"),n.erYk(e,"apxor_event",t)):"customer"===(null==e?void 0:e.loggedBy)&&n.erYk(e,"customer_event",t),"campaign"===(null==e?void 0:e.apx_nudge_type)?n.erYk(e,"campaign_event",t):"survey"===(null==e?void 0:e.apx_nudge_type)&&n.erYk(e,"survey_event",t);var i=t+"___"+e.name;n.erYk(e,i,t)})),s(this,"erYk",(function(t,i,r){if(n.rOAr){if(X.debug("Notifying listeners for event: "+t+", "+i,n.Gqai),n.Gqai[i])for(var o=n.Gqai[i],a=e.getController().getSDKRunningTimeInSec(),s=0;s<o.length;s++){(0,o[s])(r,t.name,a,t.additional_info)}}else n.Qihk.push({event:t,key:i,type:r})}))})),$=window.ApxorLogger,ee=function(){function t(){var n=this;return r(this,t),s(this,"RNLW",!1),s(this,"APiT",null),s(this,"AFNP",A()),s(this,"pLAW",new U),s(this,"KwOt",e.getSiteId()),s(this,"hAcZ",{}),s(this,"getQeState",(function(){try{var t=e.getController().getFromStorage("qe_state");return t?JSON.parse(p(n.KwOt,t)):(n.hAcZ={},n.setQeState())}catch(e){return n.hAcZ={},n.setQeState()}})),s(this,"setQeState",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";try{e.getController().persistToStorage("qe_state",n.hAcZ,!0)}catch(i){""===t?n.hAcZ={}:n.hAcZ[t]={SESSION:0,OVERALL:0,DATES:{}},e.getController().persistToStorage("qe_state",n.hAcZ,!0)}return n.hAcZ})),s(this,"initialize",(function(){n.RNLW||(n.RNLW=!0,n.APiT=new J,n.pLAW.initialize(),n.hAcZ=n.getQeState(),$.info("QE Initialized.."))})),s(this,"parse",(function(e){n.Ohto()?(n.APiT.parse(e),n.pLAW.waLc()):$.warn("Must call init first. Unable to proceed")})),s(this,"validate",(function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;n.Ohto()&&n.APiT.validate(e,t,i)})),s(this,"getVariantCode",(function(e){return n.APiT.getVariantCode(e)})),s(this,"validateForTermination",(function(e,t){n.Ohto()&&n.APiT.validateForTermination(e,t)})),s(this,"validateForTerminationAttributes",(function(e,t){return n.APiT.validateForTerminationAttributes(e,t)})),s(this,"updateCount",(function(e){try{f(n.hAcZ[e])||n.createObjConfig(e),n.incrementFrequencies(e),n.setQeState(e),n.APiT.UtKe(e)}catch(e){console.log("Could not update the count config:".concat(e))}})),s(this,"resetFrequencyCounts",(function(){n.APiT.resetFrequencyCounts()})),s(this,"getFrequencyCount",(function(e){return n.APiT.getFrequencyCount(e)})),s(this,"registerForEvent",(function(e,t){console.log("registered event",e),n.pLAW.ZuiO(e,t)})),s(this,"unregisterFromEvent",(function(e,t){console.log("in unregister"),n.pLAW.unregisterFromEvent(e,t)})),s(this,"notifyEventListener",(function(e){n.pLAW.OPRg(e)})),s(this,"fetch",(function(t,n,i,r){e.getController().fetchConfiguration(t,n,i,r)})),s(this,"Ohto",(function(){return n.RNLW})),s(this,"getCampaignMetaFromQueryEngine",(function(e){return n.APiT.siZw(e)})),s(this,"GDlh",(function(){return n.AFNP})),t.instance||(t.instance=this),t.instance}return a(t,[{key:"createObjConfig",value:function(e){try{this.hAcZ=this.getQeState(),f(this.hAcZ[e])||(this.hAcZ[e]={SESSION:0,OVERALL:0,DATES:{}},this.AFNP&&(this.hAcZ[e].DATES[this.AFNP]=0),this.setQeState(e))}catch(e){$.error("Can not create the frequency count object:"+e)}}},{key:"incrementFrequencies",value:function(e){this.hAcZ=this.getQeState();var t=this.hAcZ[e];t.SESSION=t.SESSION+1,t.OVERALL=t.OVERALL+1;var n=A();n===this.AFNP&&t.DATES&&t.DATES[n]||(this.AFNP=n,t.DATES={},t.DATES[this.AFNP]=0),t.DATES[this.AFNP]=t.DATES[this.AFNP]+1}}],[{key:"getInstance",value:function(){return t.instance||(t.instance=new t),t.instance}}]),t}();s(ee,"instance",void 0),window.ceVersion=160;try{void 0===exports&&null===exports||(exports.default=ee,module.exports=exports.default)}catch(e){}return ee}));
